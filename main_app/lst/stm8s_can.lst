RCSTM8 COMPILER V2.42.12.083,  STM8S_CAN          05/19/25  15:34:38

QCW(0x00963FA0)

RCSTM8 COMPILER V2.42.12.083, COMPILATION OF MODULE STM8S_CAN 
OBJECT MODULE PLACED IN C:\Users\sravi\Downloads\E1M2_0036\E1M2_0036\main_app\bin\stm8s_can.obj
COMPILER INVOKED BY: QUIET GENERATEDEPFILE CODE DB OJ(C:\Users\sravi\Downloads\E1M2_0036\E1M2_0036\main_app\bin\stm8s_can.obj) PR(C:\Users\sravi\Downloads\E1M2_0036\E1M2_0036\main_app\lst\stm8s_can.lst) PIN(C:\Raisonance\Ride\Inc;C:\Raisonance\Ride\Inc\ST7;C:\Raisonance\Ride\Inc\STM8;C:\Users\sravi\Downloads\E1M2_0036\E1M2_0036\main_app\inc) STM8(SMALL) O(3,SIZE) NOINITSTATICVAR SMALLOBJECT ET(INT) 

stmt level    source
   1          /* Includes ------------------------------------------------------------------*/
   2          #include "stm8s_can.h"
   3          #include "stm8s_eol.h"
   4          /** @addtogroup STM8S_StdPeriph_Driver
   5            * @{
   6            */
   7          /* Private typedef -----------------------------------------------------------*/
   8          /* Private define ------------------------------------------------------------*/
   9          #define CAN_IDLIST_IDMASK_MASK ((uint8_t) 0x55)
  10          #define CAN_IDMASK_IDLIST_MASK ((uint8_t) 0xAA)
  11          #define CAN_MODE_MASK ((uint8_t) 0x03)
  12          #define CAN_ACKNOWLEDGE_TIMEOUT ((uint16_t)0xFFFF)
  13          /* Private macro -------------------------------------------------------------*/
  14          /* Private variables ---------------------------------------------------------*/
  15          __IO uint32_t _Id = 0;
  16          __IO uint8_t _IDE = 0;
  17          __IO uint8_t _RTR = 0;
  18          __IO uint8_t _DLC = 0;
  19          __IO uint8_t _Data[8] = {0};
  20          __IO uint8_t _FMI = 0;
  21          /* Private function prototypes -----------------------------------------------*/
  22          static ITStatus CheckITStatus(uint8_t CAN_Reg, uint8_t It_Bit);
  23          
  24          // Globals!
  25          uint8_t  l_can_data[10]={0};
  26          uint8_t  l_can_receive_flag=0;
  27          
  28          /* Private functions ---------------------------------------------------------*/
  29          /**
  30            * @addtogroup CAN_Public_Functions
  31            * @{
  32            */
  33          
  34          /**
  35            * @brief  Deinitializes the CAN peripheral registers to their default reset values.
  36            * @param  None
  37            * @retval None
  38            */
  39          void CAN_DeInit(void)
  40          {
  41   1          /* Request initialisation */
  42   1          CAN->MCR = CAN_MCR_INRQ;
  43   1          CAN->PSR = CAN_Page_Config;
  44   1          CAN_OperatingModeRequest(CAN_OperatingMode_Initialization);
  45   1          CAN->Page.Config.ESR = CAN_ESR_RESET_VALUE;
  46   1          CAN->Page.Config.EIER = CAN_EIER_RESET_VALUE;
  47   1          CAN->Page.Config.BTR1 = CAN_BTR1_RESET_VALUE;
  48   1          CAN->Page.Config.BTR2 = CAN_BTR2_RESET_VALUE;
  49   1          CAN->Page.Config.FMR1 = CAN_FMR1_RESET_VALUE;
  50   1          CAN->Page.Config.FMR2 = CAN_FMR2_RESET_VALUE;
  51   1          CAN->Page.Config.FCR1 = CAN_FCR_RESET_VALUE;
  52   1          CAN->Page.Config.FCR2 = CAN_FCR_RESET_VALUE;
  53   1          CAN->Page.Config.FCR3 = CAN_FCR_RESET_VALUE;
  54   1          CAN_OperatingModeRequest(CAN_OperatingMode_Normal);
  55   1          CAN->PSR = CAN_Page_RxFifo;
  56   1          CAN->Page.RxFIFO.MDLCR = CAN_MDLC_RESET_VALUE;
  57   1          CAN->PSR = CAN_Page_TxMailBox0;
  58   1          CAN->Page.TxMailbox.MDLCR = CAN_MDLC_RESET_VALUE;
  59   1          CAN->PSR = CAN_Page_TxMailBox1;
  60   1          CAN->Page.TxMailbox.MDLCR = CAN_MDLC_RESET_VALUE;
  61   1          CAN->PSR = CAN_Page_TxMailBox2;
  62   1          CAN->Page.TxMailbox.MDLCR = CAN_MDLC_RESET_VALUE;
  63   1      
  64   1          CAN->MCR = CAN_MCR_RESET_VALUE;
  65   1          CAN->MSR = (uint8_t)(~CAN_MSR_RESET_VALUE);/* rc_w1 */
  66   1          CAN->TSR = (uint8_t)(~CAN_TSR_RESET_VALUE);/* rc_w1 */
  67   1          CAN->RFR = (uint8_t)(~CAN_RFR_RESET_VALUE);/* rc_w1 */
  68   1          CAN->IER = CAN_IER_RESET_VALUE;
  69   1          CAN->DGR = CAN_DGR_RESET_VALUE;
  70   1          CAN->PSR = CAN_PSR_RESET_VALUE;
  71   1      }
  72          
  73          /**
  74            * @brief  Initializes the CAN peripheral according to the specified parameters.
  75            * @param   CAN_MasterCtrl : Master control option, can be one or a combination of @ref CAN_MasterCtrl_TypeDef.
  76            * @param   CAN_Mode : CAN mode , can be one of @ref CAN_Mode_TypeDef.
  77            * @param   CAN_SynJumpWidth : CAN Synchronisation Jump Width , can be one of @ref CAN_SynJumpWidth_TypeDef.
  78            * @param   CAN_BitSeg1 : CAN bit segment 1 , can be one of @ref CAN_BitSeg1_TypeDef.
  79            * @param   CAN_BitSeg2 : CAN bit segment 2 , can be one of @ref CAN_BitSeg2_TypeDef.
  80            * @param   CAN_Prescaler : CAN Baud Rate Prescaler , can be a value from 0x01 to 0xFF.
  81            * @retval Indicates if initialization is succeed. it can be one of @ref CAN_InitStatus_TypeDef enumeration.
  82            */
  83          CAN_InitStatus_TypeDef CAN_Init(CAN_MasterCtrl_TypeDef CAN_MasterCtrl,
  84                                          CAN_Mode_TypeDef CAN_Mode,
  85                                          CAN_SynJumpWidth_TypeDef CAN_SynJumpWidth,
  86                                          CAN_BitSeg1_TypeDef CAN_BitSeg1,
  87                                          CAN_BitSeg2_TypeDef CAN_BitSeg2,
  88                                          uint8_t CAN_Prescaler)
  89          {
  90   1          CAN_InitStatus_TypeDef InitStatus =  CAN_InitStatus_Failed;
  91   1          uint16_t timeout = CAN_ACKNOWLEDGE_TIMEOUT;
  92   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
  93   1      
  94   1      
  95   1          /* Check the parameters */
  96   1          assert_param(IS_CAN_MASTERCTRL_OK(CAN_MasterCtrl));
  97   1          assert_param(IS_CAN_MODE_OK(CAN_Mode));
  98   1          assert_param(IS_CAN_SYNJUMPWIDTH_OK(CAN_SynJumpWidth));
  99   1          assert_param(IS_CAN_BITSEG1_OK(CAN_BitSeg1));
 100   1          assert_param(IS_CAN_BITSEG2_OK(CAN_BitSeg2));
 101   1          assert_param(IS_CAN_PRESCALER_OK(CAN_Prescaler));
 102   1      
 103   1          /* Request initialisation */
 104   1          CAN->MCR = CAN_MCR_INRQ;
 105   1          /* Wait the acknowledge */
 106   1          while (((uint8_t)(CAN->MSR & CAN_MSR_INAK) != 0x01) && ((uint16_t)timeout != 0))
 107   1          {
 108   2              timeout--;
 109   2          }
 110   1      
 111   1          /* Check acknowledged */
 112   1          if ((CAN->MSR & CAN_MSR_INAK) != CAN_MSR_INAK)
 113   1          {
 114   2      
 115   2              InitStatus =  CAN_InitStatus_Failed;
 116   2      
 117   2          }
 118   1          else
 119   1          {
 120   2              /* Set the time triggered communication mode  &  Set the automatic bus-off management  &   Set the automatic wake-up mode
 121   2              &     Set the no automatic retransmission & Set the receive FIFO locked mode & Set the transmit FIFO priority */
 122   2              CAN->MCR |= (uint8_t)CAN_MasterCtrl;
 123   2      
 124   2              /* Set the bit timing register */
 125   2              CAN->DGR |= (uint8_t)CAN_Mode ;
 126   2              CAN->PSR = CAN_Page_Config;
 127   2              CAN->Page.Config.BTR1 = (uint8_t)((uint8_t)(CAN_Prescaler - (uint8_t)1) | CAN_SynJumpWidth);
 128   2              CAN->Page.Config.BTR2 = (uint8_t)(CAN_BitSeg1 | (uint8_t)CAN_BitSeg2);
 129   2      
 130   2              /* Request leave initialisation */
 131   2              CAN->MCR &= (uint8_t)(~CAN_MCR_INRQ);
 132   2              /* Wait the acknowledge */
 133   2              timeout = 0xFFFF;
 134   2              while ((((uint8_t)(CAN->MSR & CAN_MSR_INAK) == 0x01))&&(timeout != 0))
 135   2              {
 136   3                  timeout--;
 137   3              }
 138   2              /* Check acknowledged */
 139   2              if ((CAN->MSR & CAN_MSR_INAK) == CAN_MSR_INAK)
 140   2              {
 141   3                  InitStatus = CAN_InitStatus_Failed;
 142   3              }
 143   2              else
 144   2              {
 145   3                  InitStatus = CAN_InitStatus_Success;
 146   3              }
 147   2          }
 148   1          /*Restore Last Page*/
 149   1          CAN_SelectPage(can_page);
 150   1      
 151   1          /* Return the status of initialization */
 152   1          return (CAN_InitStatus_TypeDef)InitStatus;
 153   1      }
 154          
 155          /**
 156            * @brief  Initializes the CAN peripheral Filter according to the specified parameters.
 157            * @param   CAN_FilterNumber : CAN Filter number , can be one of @ref CAN_FilterNumber_TypeDef
 158            * @param   CAN_FilterActivation : CAN Filter Activation state , can be one of @ref FunctionalState
 159            * @param   CAN_FilterMode : CAN Filter Mode , can be one of @ref CAN_FilterMode_TypeDef
 160            * @param   CAN_FilterScale : CAN Filter Scale , can be one of @ref CAN_FilterScale_TypeDef
 161            * @param   CAN_FilterID1 : CAN Filter ID 1 , can be a value from 0x00 to 0xFF
 162            * @param   CAN_FilterID2 : CAN Filter ID 2 , can be a value from 0x00 to 0xFF
 163            * @param   CAN_FilterID3 : CAN Filter ID 3 , can be a value from 0x00 to 0xFF
 164            * @param   CAN_FilterID4 : CAN Filter ID 4 , can be a value from 0x00 to 0xFF
 165            * @param   CAN_FilterIDMask1 : CAN Filter ID 1/ Mask 1  , can be a value from 0x00 to 0xFF depending of CAN_FilterMode parameter
 166            * @param   CAN_FilterIDMask2 : CAN Filter ID 2/ Mask 2 , can be a value from 0x00 to 0xFF depending of CAN_FilterMode parameter
 167            * @param   CAN_FilterIDMask3 : CAN Filter ID 3/ Mask 3 , can be a value from 0x00 to 0xFF depending of CAN_FilterMode parameter
 168            * @param   CAN_FilterIDMask4 : CAN Filter ID 4/ Mask 4 , can be a value from 0x00 to 0xFF depending of CAN_FilterMode parameter
 169            * @retval None
 170            */
 171          void CAN_FilterInit(CAN_FilterNumber_TypeDef CAN_FilterNumber,
 172                              FunctionalState CAN_FilterActivation,
 173                              CAN_FilterMode_TypeDef CAN_FilterMode,
 174                              CAN_FilterScale_TypeDef CAN_FilterScale,
 175                              uint8_t CAN_FilterID1,
 176                              uint8_t CAN_FilterID2,
 177                              uint8_t CAN_FilterID3,
 178                              uint8_t CAN_FilterID4,
 179                              uint8_t CAN_FilterIDMask1,
 180                              uint8_t CAN_FilterIDMask2,
 181                              uint8_t CAN_FilterIDMask3,
 182                              uint8_t CAN_FilterIDMask4)
 183          {
 184   1          uint8_t fact = 0;
 185   1          uint8_t fsc  = 0;
 186   1          uint8_t fmhl = 0;
 187   1      
 188   1          CAN_Page_TypeDef can_page_filter = CAN_Page_Filter01;
 189   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 190   1      
 191   1          /* Check the parameters */
 192   1          assert_param(IS_CAN_FILTER_NUMBER_OK(CAN_FilterNumber));
 193   1          assert_param(IS_FUNCTIONALSTATE_OK(CAN_FilterActivation));
 194   1          assert_param(IS_CAN_FILTER_MODE_OK(CAN_FilterMode));
 195   1          assert_param(IS_CAN_FILTER_SCALE_OK(CAN_FilterScale));
 196   1      
 197   1      
 198   1          if (CAN_FilterNumber == CAN_FilterNumber_0)
 199   1          {
 200   2              fact = 0x01;
 201   2              fsc  = 0x00;
 202   2              fmhl = 0x03;
 203   2      
 204   2              can_page_filter = CAN_Page_Filter01;
 205   2          }
 206   1          else if (CAN_FilterNumber == CAN_FilterNumber_1)
 207   1          {
 208   2              fact = 0x10;
 209   2              fsc  = 0x04;
 210   2              fmhl = 0x0C;
 211   2      
 212   2              can_page_filter = CAN_Page_Filter01;
 213   2          }
 214   1          else if (CAN_FilterNumber == CAN_FilterNumber_2)
 215   1          {
 216   2              fact = 0x01;
 217   2              fsc  = 0x00;
 218   2              fmhl = 0x30;
 219   2      
 220   2              can_page_filter = CAN_Page_Filter23;
 221   2          }
 222   1          else if (CAN_FilterNumber == CAN_FilterNumber_3)
 223   1          {
 224   2              fact = 0x10;
 225   2              fsc  = 0x04;
 226   2              fmhl = 0xC0;
 227   2      
 228   2              can_page_filter = CAN_Page_Filter23;
 229   2          }
 230   1          else if (CAN_FilterNumber == CAN_FilterNumber_4)
 231   1          {
 232   2              fact = 0x01;
 233   2              fsc  = 0x00;
 234   2              fmhl = 0x03;
 235   2      
 236   2              can_page_filter = CAN_Page_Filter45;
 237   2          }
 238   1          else /*if (CAN_FilterNumber == CAN_FilterNumber_5)*/
 239   1          {
 240   2              fact = 0x10;
 241   2              fsc  = 0x04;
 242   2              fmhl = 0x0C;
 243   2      
 244   2              can_page_filter = CAN_Page_Filter45;
 245   2          }
 246   1      
 247   1      
 248   1          CAN_OperatingModeRequest(CAN_OperatingMode_Initialization);
 249   1      
 250   1          CAN->PSR = CAN_Page_Config;
 251   1          /*---------------------------------------------------------*/
 252   1          /*Configuration of Filter Scale                            */
 253   1          /*---------------------------------------------------------*/
 254   1      
 255   1          if (can_page_filter == CAN_Page_Filter01) /* FCR1 */
 256   1          {
 257   2              /* Filter Deactivation  & Reset the Filter Scale */
 258   2              CAN->Page.Config.FCR1 &= (uint8_t)(~(uint8_t)(fact | (uint8_t)((uint8_t)(CAN_FCR1_FSC00|CAN_FCR1_FSC01) << fsc )));
 259   2              /* Set the new Filter Scale */
 260   2              CAN->Page.Config.FCR1 |= (uint8_t)(CAN_FilterScale << fsc);
 261   2          }
 262   1          else if (can_page_filter == CAN_Page_Filter23) /* FCR2*/
 263   1          {
 264   2              /* Filter Deactivation  & Reset the Filter Scale */
 265   2              CAN->Page.Config.FCR2 &= (uint8_t)~(uint8_t)( fact | (uint8_t)((uint8_t)(CAN_FCR1_FSC00|CAN_FCR1_FSC01) << fsc ));
 266   2      
 267   2              /* Set the new Filter Scale */
 268   2              CAN->Page.Config.FCR2 |= (uint8_t)(CAN_FilterScale << fsc);
 269   2      
 270   2          }
 271   1          else /*if(can_page_filter == CAN_Page_Filter45)*/ /* FCR3*/
 272   1          {
 273   2              /* Filter Deactivation  & Reset the Filter Scale */
 274   2              CAN->Page.Config.FCR3 &= (uint8_t)~(uint8_t)( fact | (uint8_t)((uint8_t)(CAN_FCR1_FSC00|CAN_FCR1_FSC01) << fsc ));
 275   2      
 276   2              /* Set the new Filter Scale */
 277   2              CAN->Page.Config.FCR3 |= (uint8_t)(CAN_FilterScale << fsc);
 278   2          }
 279   1      
 280   1          /*---------------------------------------------------------*/
 281   1          /*Configuration of Filter Mode                             */
 282   1          /*---------------------------------------------------------*/
 283   1          if (can_page_filter != CAN_Page_Filter45) /* FMR1*/
 284   1          {
 285   2              /* Filter Mode */
 286   2              if (CAN_FilterMode == CAN_FilterMode_IdMask)
 287   2              {
 288   3                  /*Id/Mask mode for the filter*/
 289   3                  CAN->Page.Config.FMR1 &= (uint8_t)~(fmhl);
 290   3              }
 291   2              else if ( CAN_FilterMode == CAN_FilterMode_IdList)
 292   2              {
 293   3                  /*Identifier list mode for the filter*/
 294   3                  CAN->Page.Config.FMR1 |= (uint8_t)(fmhl);
 295   3              }
 296   2              else if ( CAN_FilterMode == CAN_FilterMode_IdList_IdMask)
 297   2              {
 298   3                  /*Identifier list mode is first  for the filter*/
 299   3                  CAN->Page.Config.FMR1 |= (uint8_t)(fmhl & CAN_IDLIST_IDMASK_MASK);
 300   3              }
 301   2              else /* ( CAN_FilterMode == CAN_FilterMode_IdMask_IdList)*/
 302   2              {
 303   3                  /*Id Mask mode is first  for the filter*/
 304   3                  CAN->Page.Config.FMR1 |= (uint8_t)(fmhl & CAN_IDMASK_IDLIST_MASK);
 305   3              }
 306   2      
 307   2      
 308   2          }
 309   1          else /* FMR2 */
 310   1          {
 311   2      
 312   2              /* Filter Mode */
 313   2              if (CAN_FilterMode == CAN_FilterMode_IdMask)
 314   2              {
 315   3                  /*Id/Mask mode for the filter*/
 316   3                  CAN->Page.Config.FMR2 &= (uint8_t)~(fmhl);
 317   3              }
 318   2              else if ( CAN_FilterMode == CAN_FilterMode_IdList)
 319   2              {
 320   3                  /*Identifier list mode for the filter*/
 321   3                  CAN->Page.Config.FMR2 |= (uint8_t)(fmhl);
 322   3              }
 323   2              else if ( CAN_FilterMode == CAN_FilterMode_IdList_IdMask)
 324   2              {
 325   3                  /*Identifier list mode is first  for the filter*/
 326   3                  CAN->Page.Config.FMR2 |= (uint8_t)(fmhl & CAN_IDLIST_IDMASK_MASK);
 327   3              }
 328   2              else /* ( CAN_FilterMode == CAN_FilterMode_IdMask_IdList)*/
 329   2              {
 330   3                  /*Id Mask mode is first  for the filter*/
 331   3                  CAN->Page.Config.FMR2 |= (uint8_t)(fmhl & CAN_IDMASK_IDLIST_MASK);
 332   3              }
 333   2          }
 334   1          /*---------------------------------------------------------*/
 335   1          /*Configuration of Filter IDs                              */
 336   1          /*---------------------------------------------------------*/
 337   1          CAN->PSR = (uint8_t)can_page_filter;
 338   1          if (fsc != 0)
 339   1          {
 340   2              /* Filter Scale */
 341   2              if (CAN_FilterScale == CAN_FilterScale_8Bit)
 342   2              {
 343   3                  CAN->Page.Filter.FR09 = CAN_FilterID1;
 344   3                  CAN->Page.Filter.FR10 = CAN_FilterIDMask1;
 345   3                  CAN->Page.Filter.FR11 = CAN_FilterID2;
 346   3                  CAN->Page.Filter.FR12 = CAN_FilterIDMask2;
 347   3                  CAN->Page.Filter.FR13 = CAN_FilterID3;
 348   3                  CAN->Page.Filter.FR14 = CAN_FilterIDMask3;
 349   3                  CAN->Page.Filter.FR15 = CAN_FilterID4;
 350   3                  CAN->Page.Filter.FR16 = CAN_FilterIDMask4;
 351   3              }
 352   2              else if (CAN_FilterScale == CAN_FilterScale_16_8Bit)
 353   2              {
 354   3                  CAN->Page.Filter.FR09 = CAN_FilterID1;
 355   3                  CAN->Page.Filter.FR10 = CAN_FilterID2;
 356   3                  CAN->Page.Filter.FR11 = CAN_FilterIDMask1;
 357   3                  CAN->Page.Filter.FR12 = CAN_FilterIDMask2;
 358   3                  CAN->Page.Filter.FR13 = CAN_FilterID3;
 359   3                  CAN->Page.Filter.FR14 = CAN_FilterIDMask3;
 360   3                  CAN->Page.Filter.FR15 = CAN_FilterID4;
 361   3                  CAN->Page.Filter.FR16 = CAN_FilterIDMask4;
 362   3              }
 363   2              else if (CAN_FilterScale == CAN_FilterScale_16Bit)
 364   2              {
 365   3                  CAN->Page.Filter.FR09 = CAN_FilterID1;
 366   3                  CAN->Page.Filter.FR10 = CAN_FilterID2;
 367   3                  CAN->Page.Filter.FR11 = CAN_FilterIDMask1;
 368   3                  CAN->Page.Filter.FR12 = CAN_FilterIDMask2;
 369   3                  CAN->Page.Filter.FR13 = CAN_FilterID3;
 370   3                  CAN->Page.Filter.FR14 = CAN_FilterID4;
 371   3                  CAN->Page.Filter.FR15 = CAN_FilterIDMask3;
 372   3                  CAN->Page.Filter.FR16 = CAN_FilterIDMask4;
 373   3              }
 374   2              else if (CAN_FilterScale == CAN_FilterScale_32Bit)
 375   2              {
 376   3                  CAN->Page.Filter.FR09 = CAN_FilterID1;
 377   3                  CAN->Page.Filter.FR10 = CAN_FilterID2;
 378   3                  CAN->Page.Filter.FR11 = CAN_FilterID3;
 379   3                  CAN->Page.Filter.FR12 = CAN_FilterID4;
 380   3                  CAN->Page.Filter.FR13 = CAN_FilterIDMask1;
 381   3                  CAN->Page.Filter.FR14 = CAN_FilterIDMask2;
 382   3                  CAN->Page.Filter.FR15 = CAN_FilterIDMask3;
 383   3                  CAN->Page.Filter.FR16 = CAN_FilterIDMask4;
 384   3              }
 385   2          }
 386   1          else
 387   1          {
 388   2              /* Filter Scale */
 389   2              if (CAN_FilterScale == CAN_FilterScale_8Bit)
 390   2              {
 391   3                  CAN->Page.Filter.FR01 = CAN_FilterID1;
 392   3                  CAN->Page.Filter.FR02 = CAN_FilterIDMask1;
 393   3                  CAN->Page.Filter.FR03 = CAN_FilterID2;
 394   3                  CAN->Page.Filter.FR04 = CAN_FilterIDMask2;
 395   3                  CAN->Page.Filter.FR05 = CAN_FilterID3;
 396   3                  CAN->Page.Filter.FR06 = CAN_FilterIDMask3;
 397   3                  CAN->Page.Filter.FR07 = CAN_FilterID4;
 398   3                  CAN->Page.Filter.FR08 = CAN_FilterIDMask4;
 399   3              }
 400   2              else if (CAN_FilterScale == CAN_FilterScale_16_8Bit)
 401   2              {
 402   3                  CAN->Page.Filter.FR01 = CAN_FilterID1;
 403   3                  CAN->Page.Filter.FR02 = CAN_FilterID2;
 404   3                  CAN->Page.Filter.FR03 = CAN_FilterIDMask1;
 405   3                  CAN->Page.Filter.FR04 = CAN_FilterIDMask2;
 406   3                  CAN->Page.Filter.FR05 = CAN_FilterID3;
 407   3                  CAN->Page.Filter.FR06 = CAN_FilterIDMask3;
 408   3                  CAN->Page.Filter.FR07 = CAN_FilterID4;
 409   3                  CAN->Page.Filter.FR08 = CAN_FilterIDMask4;
 410   3              }
 411   2              else if (CAN_FilterScale == CAN_FilterScale_16Bit)
 412   2              {
 413   3                  CAN->Page.Filter.FR01 = CAN_FilterID1;
 414   3                  CAN->Page.Filter.FR02 = CAN_FilterID2;
 415   3                  CAN->Page.Filter.FR03 = CAN_FilterIDMask1;
 416   3                  CAN->Page.Filter.FR04 = CAN_FilterIDMask2;
 417   3                  CAN->Page.Filter.FR05 = CAN_FilterID3;
 418   3                  CAN->Page.Filter.FR06 = CAN_FilterID4;
 419   3                  CAN->Page.Filter.FR07 = CAN_FilterIDMask3;
 420   3                  CAN->Page.Filter.FR08 = CAN_FilterIDMask4;
 421   3              }
 422   2              else if (CAN_FilterScale == CAN_FilterScale_32Bit)
 423   2              {
 424   3                  CAN->Page.Filter.FR01 = CAN_FilterID1;
 425   3                  CAN->Page.Filter.FR02 = CAN_FilterID2;
 426   3                  CAN->Page.Filter.FR03 = CAN_FilterID3;
 427   3                  CAN->Page.Filter.FR04 = CAN_FilterID4;
 428   3                  CAN->Page.Filter.FR05 = CAN_FilterIDMask1;
 429   3                  CAN->Page.Filter.FR06 = CAN_FilterIDMask2;
 430   3                  CAN->Page.Filter.FR07 = CAN_FilterIDMask3;
 431   3                  CAN->Page.Filter.FR08 = CAN_FilterIDMask4;
 432   3              }
 433   2          }
 434   1      
 435   1      
 436   1          /*---------------------------------------------------------*/
 437   1          /*Configuration of Filter Activation                       */
 438   1          /*---------------------------------------------------------*/
 439   1          /* Filter activation */
 440   1          CAN->PSR = CAN_Page_Config;
 441   1          if (CAN_FilterActivation != DISABLE)
 442   1          {
 443   2              if ((CAN_FilterNumber & 0x06) == 0x00) /* FCR1*/
 444   2              {   CAN->Page.Config.FCR1 |= (uint8_t)fact;
 445   3              }
 446   2              else if ((CAN_FilterNumber & 0x06) == 0x02) /*FCR2*/
 447   2              { CAN->Page.Config.FCR2 |= (uint8_t)fact;
 448   3              }
 449   2              else /*if((CAN_FilterNumber & 0x06) == 0x04)*/ /*FCR3*/
 450   2              { CAN->Page.Config.FCR3 |= (uint8_t)fact;
 451   3              }
 452   2          }
 453   1          CAN_OperatingModeRequest(CAN_OperatingMode_Normal);
 454   1          /*Restore Last Page*/
 455   1          CAN_SelectPage(can_page);
 456   1      }
 457          
 458          /**
 459            * @brief   Enables or disables the specified CAN interrupts.
 460            * @param    CAN_IT: specifies the CAN interrupt sources to be enabled or disabled.
 461            * @param   NewState : CAN_IT new state , can be one of @ref FunctionalState
 462            * @retval None
 463            */
 464          void CAN_ITConfig(CAN_IT_TypeDef CAN_IT, FunctionalState NewState)
 465          {
 466   1          uint8_t tmperrorinterrupt = 0;
 467   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 468   1      
 469   1      
 470   1          /* Check the parameters */
 471   1          assert_param(IS_CAN_IT_CONFIG_OK(CAN_IT));
 472   1          assert_param(IS_FUNCTIONALSTATE_OK(NewState));
 473   1      
 474   1          tmperrorinterrupt = (uint8_t)(((uint16_t)CAN_IT) >>7);
 475   1          tmperrorinterrupt = (uint8_t)((uint8_t)((uint16_t)tmperrorinterrupt & 0xF0) | 
 476   1                                        (uint8_t)((uint8_t)((uint16_t)tmperrorinterrupt & 0x0F) >>1));
 477   1      
 478   1          CAN->PSR = CAN_Page_Config;
 479   1          if (NewState != DISABLE)
 480   1          {
 481   2              /* Enable the selected CAN interrupt */
 482   2              CAN->IER |= (uint8_t)(CAN_IT);
 483   2              CAN->Page.Config.EIER |= (uint8_t)(tmperrorinterrupt);
 484   2          }
 485   1          else
 486   1          {
 487   2              /* Disable the selected CAN interrupt */
 488   2              CAN->IER &= (uint8_t)~(uint8_t)((uint16_t)CAN_IT);
 489   2              CAN->Page.Config.EIER &= (uint8_t)~(tmperrorinterrupt);
 490   2          }
 491   1          /*Restore Last Page*/
 492   1          CAN_SelectPage(can_page);
 493   1      }
 494          
 495          /**
 496            * @brief   Enables or Disables the ST7 CAN Compatibility.
 497            * if the ST7 compatibility is Enabled, CAN provides only 2 mailboxes.
 498            * if the ST7 compatibility is Disabled, CAN provides 3 mailboxes.
 499            * @param   CAN_ST7Compatibility : CAN ST7 Compatibility , this parameter can be one of @ref CAN_ST7Compatibility_TypeDef enumeration.
 500            * @retval None
 501            */
 502          void CAN_ST7CompatibilityCmd(CAN_ST7Compatibility_TypeDef CAN_ST7Compatibility)
 503          {
 504   1          /* Check the parameters */
 505   1          assert_param(IS_CAN_ST7_COMPATIBILITY_OK(CAN_ST7Compatibility));
 506   1          /*Reset the old configuration of TXM2E */
 507   1          CAN->DGR &= (uint8_t)(~CAN_DGR_TXM2E);
 508   1      
 509   1          /*Set the old configuration of TXM2E */
 510   1          CAN->DGR |= (uint8_t)CAN_ST7Compatibility;
 511   1      }
 512          
 513          /**
 514            * @brief  Enables or disables the CAN Time TriggerOperation communication mode.
 515            * @param   NewState : Mode new state , can be one of @ref FunctionalState
 516            * @retval None
 517            */
 518          void CAN_TTComModeCmd(FunctionalState NewState)
 519          {
 520   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 521   1          /* Check the parameters */
 522   1          assert_param(IS_FUNCTIONALSTATE_OK(NewState));
 523   1          if (NewState != DISABLE)
 524   1          {
 525   2              /*Enable the TTCM mode */
 526   2              CAN->MCR |= CAN_MCR_TTCM;
 527   2              /*Set TGT bits setting in Tx and FIFO pages*/
 528   2              CAN->PSR = CAN_Page_TxMailBox0;
 529   2              CAN->Page.TxMailbox.MDLCR |= CAN_MDLCR_TGT;
 530   2              CAN->PSR = CAN_Page_TxMailBox1;
 531   2              CAN->Page.TxMailbox.MDLCR |= CAN_MDLCR_TGT;
 532   2              CAN->PSR = CAN_Page_TxMailBox2;
 533   2              CAN->Page.TxMailbox.MDLCR |= CAN_MDLCR_TGT;
 534   2              CAN->PSR = CAN_Page_RxFifo;
 535   2              CAN->Page.RxFIFO.MDLCR |= CAN_MDLCR_TGT;
 536   2          }
 537   1          else
 538   1          {
 539   2              /*Disable the TTCM mode */
 540   2              CAN->MCR &= ((uint8_t)~CAN_MCR_TTCM);
 541   2              /*Reset TGT bits setting in Tx and FIFO pages*/
 542   2              CAN->PSR = CAN_Page_TxMailBox0;
 543   2              CAN->Page.TxMailbox.MDLCR &= ((uint8_t)~CAN_MDLCR_TGT);
 544   2              CAN->PSR = CAN_Page_TxMailBox1;
 545   2              CAN->Page.TxMailbox.MDLCR &= ((uint8_t)~CAN_MDLCR_TGT);
 546   2              CAN->PSR = CAN_Page_TxMailBox2;
 547   2              CAN->Page.TxMailbox.MDLCR &= ((uint8_t)~CAN_MDLCR_TGT);
 548   2              CAN->PSR = CAN_Page_RxFifo;
 549   2              CAN->Page.RxFIFO.MDLCR &= ((uint8_t)~CAN_MDLCR_TGT);
 550   2          }
 551   1          /*Restore Last Page*/
 552   1          CAN_SelectPage(can_page);
 553   1      }
 554          
 555          /**
 556            * @brief  Initiates the transmission of a message.
 557            * @param   CAN_Id the ID number of the message, its size depends on @ref CAN_IDE value.
 558            * @param[in] CAN_IDE the ID type of the message, this parameter can be one of the @ref CAN_Id_TypeDef enumeration.
 559            * @param[in] CAN_RTR the message type, this parameter can be one of the @ref CAN_RTR_TypeDef enumeration.
 560            * @param[in] CAN_DLC the number of data in the message type, this parameter can be a value between 0 to 7.
 561            * @param[in] CAN_Data pointer to a the @ref uint8_t table which contains data to sent.
 562            * @retval Transmit Status, this returned value can be one of the @ref CAN_TxStatus_TypeDef enumeration.
 563            */
 564          CAN_TxStatus_TypeDef CAN_Transmit(uint32_t CAN_Id,
 565                                            CAN_Id_TypeDef CAN_IDE,
 566                                            CAN_RTR_TypeDef CAN_RTR,
 567                                            uint8_t CAN_DLC,
 568                                            uint8_t *CAN_Data)
 569          {
 570   1          CAN_TxStatus_TypeDef CAN_TxStatus = CAN_TxStatus_NoMailBox;
 571   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 572   1          /* Check the parameters */
 573   1          assert_param(IS_CAN_IDTYPE_OK(CAN_IDE));
 574   1          if (CAN_IDE != CAN_Id_Standard)
 575   1          {
 576   2              assert_param(IS_CAN_EXTID_OK(CAN_Id));
 577   2          }
 578   1          else
 579   1          {
 580   2              assert_param(IS_CAN_STDID_OK(CAN_Id));
 581   2          }
 582   1          assert_param(IS_CAN_RTR_OK(CAN_RTR));
 583   1          assert_param(IS_CAN_DLC_OK(CAN_DLC));
 584   1          /* Select one empty transmit mailbox */
 585   1          if ((CAN->TPR & CAN_TPR_TME0) == CAN_TPR_TME0)
 586   1          {
 587   2              CAN_TxStatus = CAN_TxStatus_MailBox0Ok;
 588   2          }
 589   1          else if ((CAN->TPR & CAN_TPR_TME1) == CAN_TPR_TME1)
 590   1          {
 591   2              CAN_TxStatus = CAN_TxStatus_MailBox1Ok;
 592   2          }
 593   1          else if ((CAN->TPR & CAN_TPR_TME2) == CAN_TPR_TME2)
 594   1          {
 595   2              CAN_TxStatus = CAN_TxStatus_MailBox2Ok;
 596   2          }
 597   1          else
 598   1          {
 599   2              CAN_TxStatus = CAN_TxStatus_NoMailBox;
 600   2          }
 601   1          if (CAN_TxStatus != CAN_TxStatus_NoMailBox)
 602   1          {
 603   2              CAN->PSR = (uint8_t)CAN_TxStatus;
 604   2              /* Set up the Id */
 605   2              if (CAN_IDE != CAN_Id_Standard)
 606   2              {
 607   3                  CAN_Id &= (uint32_t)CAN_EXTID_SIZE;
 608   3                  CAN->Page.TxMailbox.MIDR4 = (uint8_t)(CAN_Id);
 609   3                  CAN_Id = CAN_Id>>8;
 610   3                  CAN->Page.TxMailbox.MIDR3 = (uint8_t)(CAN_Id);
 611   3                  CAN_Id = CAN_Id>>8;
 612   3                  CAN->Page.TxMailbox.MIDR2 = (uint8_t)(CAN_Id);
 613   3                  CAN_Id = CAN_Id>>8;
 614   3                  CAN->Page.TxMailbox.MIDR1 = (uint8_t)(CAN_Id |CAN_IDE | CAN_RTR);
 615   3              }
 616   2              else
 617   2              {
 618   3                  CAN_Id &= (uint16_t)CAN_STDID_SIZE;
 619   3                  CAN->Page.TxMailbox.MIDR1 = (uint8_t)((CAN_Id>>6) | (CAN_RTR)) ;
 620   3                  CAN->Page.TxMailbox.MIDR2 = (uint8_t)(CAN_Id<<2);
 621   3              }
 622   2              /* Set up the DLC                 */
 623   2              /*clear old DLC value*/
 624   2              CAN->Page.TxMailbox.MDLCR &= (uint8_t)0xF0;
 625   2              /*set the new value of DLC*/
 626   2              CAN->Page.TxMailbox.MDLCR |= CAN_DLC;
 627   2              /* Set up the data field */
 628   2              CAN->Page.TxMailbox.MDAR1 = CAN_Data[0];
 629   2              CAN->Page.TxMailbox.MDAR2 = CAN_Data[1];
 630   2              CAN->Page.TxMailbox.MDAR3 = CAN_Data[2];
 631   2              CAN->Page.TxMailbox.MDAR4 = CAN_Data[3];
 632   2              CAN->Page.TxMailbox.MDAR5 = CAN_Data[4];
 633   2              CAN->Page.TxMailbox.MDAR6 = CAN_Data[5];
 634   2              CAN->Page.TxMailbox.MDAR7 = CAN_Data[6];
 635   2              CAN->Page.TxMailbox.MDAR8 = CAN_Data[7];
 636   2              /* Request transmission */
 637   2              CAN->Page.TxMailbox.MCSR |= CAN_MCSR_TXRQ;
 638   2          }
 639   1          /*Restore Last Page*/
 640   1          CAN_SelectPage(can_page);
 641   1      
 642   1          CAN_TxStatus = CAN_TransmitStatus(CAN_TransmitMailBox_0);
 643   1      
 644   1          return (CAN_TxStatus_TypeDef)CAN_TxStatus;
 645   1      }
 646          
 647          /**
 648            * @brief  Checks the transmission of a message.
 649            * @param   TransmitMailbox: the number of the mailbox that is used for transmission, can be on of  @ref CAN_TransmitMailBox_TypeDef.
 650            * @retval CAN_TxStatus_Ok if the CAN driver transmits the message, CAN_TxStatus_Failed in an other case.
 651            */
 652          CAN_TxStatus_TypeDef CAN_TransmitStatus(CAN_TransmitMailBox_TypeDef CAN_TransmitMailbox)
 653          {
 654   1          /* RQCP, TXOK and TME bits */
 655   1          CAN_TxStatus_TypeDef tstate = CAN_TxStatus_Failed;
 656   1          uint8_t tmpstate=0;
 657   1      
 658   1          /* Check the parameters */
 659   1          assert_param(IS_CAN_TRANSMITMAILBOX_OK(CAN_TransmitMailbox));
 660   1      
 661   1          switch (CAN_TransmitMailbox)
 662   1          {
 663   2          case (CAN_TransmitMailBox_0): tmpstate = (uint8_t)((CAN->TSR & (uint8_t)(CAN_TSR_RQCP0|CAN_TSR_TXOK0)));
 664   2              tmpstate |= (uint8_t)((CAN->TPR & CAN_TPR_TME0));
 665   2              break;
 666   2          case (CAN_TransmitMailBox_1): tmpstate = (uint8_t)((uint8_t)(CAN->TSR & (uint8_t)(CAN_TSR_RQCP1|CAN_TSR_TXOK1))>>1);
 667   2              tmpstate |= (uint8_t)((uint8_t)(CAN->TPR & CAN_TPR_TME1) >> 1);
 668   2              break;
 669   2          case (CAN_TransmitMailBox_2): tmpstate = (uint8_t)((uint8_t)(CAN->TSR & (uint8_t)(CAN_TSR_RQCP2|CAN_TSR_TXOK2))>>2);
 670   2              tmpstate |= (uint8_t)((uint8_t)(CAN->TPR & CAN_TPR_TME2) >> 2);
 671   2              break;
 672   2          default:
 673   2              tstate = CAN_TxStatus_Failed;
 674   2              break;
 675   2          }
 676   1      
 677   1          switch (tmpstate)
 678   1          {
 679   2              /*transmit pending  */
 680   2          case (0x00): tstate = CAN_TxStatus_Pending;
 681   2              break;
 682   2              /* transmit failed  */
 683   2          case (0x05): tstate = CAN_TxStatus_Failed;
 684   2              break;
 685   2              /* transmit succeeded */
 686   2          case (0x15): tstate = CAN_TxStatus_Ok;
 687   2              break;
 688   2              /* transmit mailbox is empty : no activity on this TX mail box */
 689   2          case (0x04): tstate = CAN_TxStatus_MailBoxEmpty;
 690   2              break;
 691   2          default:
 692   2              tstate = CAN_TxStatus_Failed;
 693   2              break;
 694   2          }
 695   1      
 696   1          return (CAN_TxStatus_TypeDef)tstate;
 697   1      }
 698          
 699          /**
 700            * @brief  Cancels a transmit request.
 701            * @param   TransmitMailbox : the Transmission mailbox, can be one of CAN_TransmitMailBox_TypeDef
 702            * @retval None
 703            */
 704          void CAN_CancelTransmit(CAN_TransmitMailBox_TypeDef CAN_TransmitMailbox)
 705          {
 706   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 707   1          /* Check the parameters */
 708   1          assert_param(IS_CAN_TRANSMITMAILBOX_OK(CAN_TransmitMailbox));
 709   1          /*switch to the specific page */
 710   1          CAN->PSR = (uint8_t)CAN_TransmitMailbox;
 711   1          /* abort transmission */
 712   1          CAN->Page.TxMailbox.MCSR |= CAN_MCSR_ABRQ;
 713   1          /*Restore Last Page*/
 714   1          CAN_SelectPage(can_page);
 715   1      }
 716          
 717          /**
 718            * @brief   Releases the CAN FIFO.
 719            * @param  None
 720            * @retval None
 721            */
 722          void CAN_FIFORelease(void)
 723          {
 724   1          /* Release FIFO*/
 725   1          CAN->RFR = CAN_RFR_RFOM; /*rc-w1*/
 726   1      }
 727          
 728          /**
 729            * @brief  Returns the number of pending messages.
 730            * @retval Number of pending messages.
 731            */
 732          CAN_NbrPendingMessage_TypeDef CAN_MessagePending(void)
 733          {
 734   1          CAN_NbrPendingMessage_TypeDef msgpending = CAN_NbrPendingMessage_0;
 735   1          msgpending = (CAN_NbrPendingMessage_TypeDef)(CAN->RFR & CAN_RFR_FMP01);
 736   1          return (CAN_NbrPendingMessage_TypeDef)msgpending;
 737   1      }
 738          
 739          /**
 740            * @brief   Receives a message which contains CAN Id, IDE, RTR
 741            * DLC, datas and FMI number.
 742            * In order to get these data, use CAN_GetReceivedId(), CAN_GetReceivedIDE(), CAN_GetReceivedRTR(),
 743            * CAN_GetReceivedDLC(), CAN_GetReceivedFMI() and CAN_GetReceivedData() functions.
 744            * @param  None
 745            * @retval None
 746            */
 747          void CAN_Receive(void)
 748          {
 749   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 750   1          uint32_t temp1 = 0, temp2 = 0, temp3 = 0;
 751   1      
 752   1          /* select Fifo page*/
 753   1          CAN->PSR = CAN_Page_RxFifo;
 754   1      
 755   1          /* Get the Id */
 756   1          _IDE = (uint8_t)(CAN->Page.RxFIFO.MIDR1 & CAN_Id_Extended);
 757   1          if (_IDE != CAN_Id_Standard)
 758   1          {
 759   2            temp1 = ((uint32_t)((uint32_t)CAN->Page.RxFIFO.MIDR3) << 8);
 760   2            temp2 = ((uint32_t)((uint32_t)CAN->Page.RxFIFO.MIDR2) << 16);  
 761   2            temp3 = ((uint32_t)((uint32_t)CAN->Page.RxFIFO.MIDR1 & 0x1F) << 24);
 762   2      
 763   2            _Id = (uint32_t)CAN_EXTID_SIZE & ((CAN->Page.RxFIFO.MIDR4) | temp1 | temp2 | temp3 );
 764   2          }
 765   1          else
 766   1          {
 767   2              temp1 = (uint16_t)((uint16_t)((uint16_t)((uint16_t)CAN->Page.RxFIFO.MIDR1 & 0x1F) << 6));
 768   2              temp2 = (uint16_t)((uint16_t)((uint16_t)CAN->Page.RxFIFO.MIDR2 >> 2)&0x3F);
 769   2      
 770   2            _Id = (uint16_t)CAN_STDID_SIZE & (temp1 | temp2 );
 771   2          }
 772   1      
 773   1          _RTR = (uint8_t)((uint8_t)0x20 & CAN->Page.RxFIFO.MIDR1);
 774   1      
 775   1          /* Get the DLC */
 776   1          _DLC = (uint8_t)(CAN->Page.RxFIFO.MDLCR & (uint8_t)0x0F);
 777   1      
 778   1          /* Get the FMI */
 779   1          _FMI = CAN->Page.RxFIFO.MFMI;
 780   1      
 781   1          /* Get the data field */
 782   1          _Data[0] = CAN->Page.RxFIFO.MDAR1;
 783   1          _Data[1] = CAN->Page.RxFIFO.MDAR2;
 784   1          _Data[2] = CAN->Page.RxFIFO.MDAR3;
 785   1          _Data[3] = CAN->Page.RxFIFO.MDAR4;
 786   1          _Data[4] = CAN->Page.RxFIFO.MDAR5;
 787   1          _Data[5] = CAN->Page.RxFIFO.MDAR6;
 788   1          _Data[6] = CAN->Page.RxFIFO.MDAR7;
 789   1          _Data[7] = CAN->Page.RxFIFO.MDAR8;
 790   1      
 791   1          
 792   1          if((_Id == 0x728) || (_Id == 0x7E8 ))       //  _Id == 0x728, 7E8 are the vehicle ID's
 793   1          {
 794   2              l_can_data[0] = _Data[0];
 795   2              l_can_data[1] = _Data[1];
 796   2              l_can_data[2] = _Data[2];
 797   2              l_can_data[3] = _Data[3];
 798   2              l_can_data[4] = _Data[4];
 799   2              l_can_data[5] = _Data[5];
 800   2              l_can_data[6] = _Data[6];
 801   2              l_can_data[7] = _Data[7];    
 802   2          }
 803   1              
 804   1          else
 805   1          {
 806   2          }
 807   1      
 808   1          l_can_receive_flag = 1;
 809   1          if((_Id == 0x7DF) &&((Timeout_EOL_Flag==FALSE) ||(Tester_Present==TRUE)))
 810   1          {
 811   2              Tester_Present=TRUE;              
 812   2          }
 813   1          else
 814   1          {
 815   2              Tester_Present=FALSE;
 816   2          }
 817   1      
 818   1          /* Release the FIFO */
 819   1          CAN_FIFORelease();
 820   1          /*Restore Last Page*/
 821   1          CAN_SelectPage(can_page);
 822   1      
 823   1      }
 824          
 825          /**
 826            * @brief  Gets the  CAN Id of the received message.
 827            * @param  None
 828            * @retval the received CAN message Id.
 829            * @par Required preconditions:
 830            * This function is used to get data loaded by CAN_Receive function.
 831            * Before using this function, CAN_Receive function must be called.
 832            */
 833          uint32_t CAN_GetReceivedId(void)
 834          {
 835   1          return (_Id);
 836   1      }
 837          
 838          /**
 839            * @brief  Gets the  CAN IDE of the received message.
 840            * @param  None
 841            * @retval the received CAN message IDE.
 842            * @par Required preconditions:
 843            * This function is used to get data loaded by CAN_Receive function.
 844            * Before using this function, CAN_Receive function must be called.
 845            */
 846          CAN_Id_TypeDef CAN_GetReceivedIDE(void)
 847          {
 848   1          return (CAN_Id_TypeDef)(_IDE);
 849   1      }
 850          
 851          /**
 852            * @brief  Gets the  CAN RTR of the received message.
 853            * @param  None
 854            * @retval the received CAN message RTR.
 855            * @par Required preconditions:
 856            * This function is used to get data loaded by CAN_Receive function.
 857            * Before using this function, CAN_Receive function must be called.
 858            */
 859          CAN_RTR_TypeDef CAN_GetReceivedRTR(void)
 860          {
 861   1          return (CAN_RTR_TypeDef)(_RTR);
 862   1      }
 863          
 864          /**
 865            * @brief  Gets the  CAN DLC of the received message.
 866            * @param  None
 867            * @retval the received CAN message DLC.
 868            * @par Required preconditions:
 869            * This function is used to get data loaded by CAN_Receive function.
 870            * Before using this function, CAN_Receive function must be called.
 871            */
 872          uint8_t CAN_GetReceivedDLC(void)
 873          {
 874   1          return (_DLC);
 875   1      }
 876          
 877          /**
 878            * @brief  Gets the  CAN Data of the received message.
 879            * @param   CAN_DataIndexe : number of the received Data, it can
 880            *  be an integer between 0 to 7.
 881            * @retval the received CAN message ith Data.
 882            * @par Required preconditions:
 883            * This function is used to get data loaded by CAN_Receive function.
 884            * Before using this function, CAN_Receive function must be called.
 885            */
 886          uint8_t CAN_GetReceivedData(uint8_t CAN_DataIndex)
 887          {
 888   1          assert_param(IS_CAN_DLC_OK(CAN_DataIndex));
 889   1          return (_Data[CAN_DataIndex]);
 890   1      }
 891          
 892          /**
 893            * @brief  Gets the  CAN FMI of the received message.
 894            * @param  None
 895            * @retval the received CAN message FMI.
 896            * @par Required preconditions:
 897            * This function is used to get data loaded by CAN_Receive function.
 898            * Before using this function, CAN_Receive function must be called.
 899            */
 900          uint8_t CAN_GetReceivedFMI(void)
 901          {
 902   1          return (_FMI);
 903   1      }
 904          
 905          /**
 906            * @brief  Returns the Received time stamp.
 907            * @param  None
 908            * @retval uint16_t the received  time stamp.
 909            */
 910          uint16_t CAN_GetMessageTimeStamp(void)
 911          {
 912   1          uint16_t timestamp = 0;
 913   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
 914   1      
 915   1          /*switch to the specific page */
 916   1          CAN->PSR = CAN_Page_RxFifo;
 917   1          /* Get the Received Time stamp */
 918   1          timestamp = CAN->Page.RxFIFO.MTSRL;
 919   1          timestamp |= (uint16_t)(((uint16_t)CAN->Page.RxFIFO.MTSRH)<<8);
 920   1      
 921   1          /*Restore Last Page*/
 922   1          CAN_SelectPage(can_page);
 923   1      
 924   1          return (uint16_t)(timestamp);
 925   1      }
 926          
 927          /**
 928            * @brief  Enters the Sleep low power mode.
 929            * @param  None
 930            * @retval  CAN_Sleep_Ok if sleep entered, CAN_Sleep_Failed in an other case.
 931            */
 932          CAN_Sleep_TypeDef CAN_Sleep(void)
 933          {
 934   1      
 935   1          CAN_Sleep_TypeDef sleepstatus = CAN_Sleep_Failed;
 936   1      
 937   1          /* Request Sleep mode */
 938   1          CAN->MCR = (uint8_t)((uint8_t)(CAN->MCR & (uint8_t)(~CAN_MCR_INRQ)) | CAN_MCR_SLEEP);
 939   1      
 940   1          /* Sleep mode status */
 941   1          if ((CAN->MSR & (CAN_MSR_SLAK|CAN_MSR_INAK)) == CAN_MSR_SLAK)
 942   1          {
 943   2              /* Sleep mode not entered */
 944   2              sleepstatus =  CAN_Sleep_Ok;
 945   2          }
 946   1      
 947   1          /* At this step, sleep mode status */
 948   1          return (CAN_Sleep_TypeDef) sleepstatus;
 949   1      }
 950          
 951          /**
 952            * @brief  Wakes the CAN up.
 953            * @param  None
 954            * @retval CAN_WakeUp_Ok if sleep mode left, CAN_WakeUp_Failed in an other  case.
 955            */
 956          CAN_WakeUp_TypeDef CAN_WakeUp(void)
 957          {
 958   1          CAN_WakeUp_TypeDef wakeupstatus = CAN_WakeUp_Failed;
 959   1      
 960   1          /* Wake up request */
 961   1          CAN->MCR &= (uint8_t)(~CAN_MCR_SLEEP);
 962   1      
 963   1          /* Sleep mode status */
 964   1          if ((CAN->MSR & CAN_MSR_SLAK) != CAN_MSR_SLAK)
 965   1          {
 966   2              /* Sleep mode exited */
 967   2              wakeupstatus = CAN_WakeUp_Ok;
 968   2          }
 969   1      
 970   1          /* At this step, sleep mode status */
 971   1          return (CAN_WakeUp_TypeDef)wakeupstatus;
 972   1      }
 973          
 974          /**
 975            * @brief  Select the CAN Operation mode.
 976            * @param  CAN_OperatingMode CAN Operating Mode ,
 977            *         this parameter can be one of @ref CAN_OperatingMode_TypeDef enumeration.
 978            * @retval the status of the requested mode which can be 
 979            *         - CAN_ModeStatus_Failed    CAN failed entring the specific mode
 980            *         - CAN_ModeStatus_Success  CAN Succeed entring the specific mode 
 981          
 982            */
 983          CAN_ModeStatus_TypeDef CAN_OperatingModeRequest(CAN_OperatingMode_TypeDef CAN_OperatingMode)
 984          {
 985   1      
 986   1          uint16_t timeout = CAN_ACKNOWLEDGE_TIMEOUT;
 987   1          uint8_t modestatus = 0;
 988   1      
 989   1          assert_param(IS_CAN_OPERATINGMODE_OK(CAN_OperatingMode));
 990   1      
 991   1          if (CAN_OperatingMode == CAN_OperatingMode_Initialization)
 992   1          {
 993   2              /* Request initialisation */
 994   2              CAN->MCR = (uint8_t)((uint8_t)(CAN->MCR & (uint8_t)(~CAN_MCR_SLEEP)) | CAN_MCR_INRQ);
 995   2      
 996   2              /* Wait the acknowledge */
 997   2              while (((CAN->MSR & CAN_MODE_MASK) != CAN_MSR_INAK) && (timeout != 0))
 998   2              {
 999   3                  timeout--;
1000   3              }
1001   2              if ((CAN->MSR & CAN_MODE_MASK) != CAN_MSR_INAK)
1002   2              {
1003   3                modestatus = CAN_ModeStatus_Failed;
1004   3              }
1005   2              else
1006   2              {
1007   3                modestatus = CAN_ModeStatus_Success;  
1008   3              }
1009   2      
1010   2          }
1011   1          else  if (CAN_OperatingMode == CAN_OperatingMode_Normal)
1012   1          {
1013   2              /* Request leave initialisation and sleep mode  and enter Normal mode */
1014   2              CAN->MCR &= (uint8_t)(~(CAN_MCR_SLEEP|CAN_MCR_INRQ));
1015   2      
1016   2              /* Wait the acknowledge */
1017   2              while (((CAN->MSR & CAN_MODE_MASK) != 0) && (timeout!=0))
1018   2              {
1019   3                  timeout--;
1020   3              }
1021   2              if ((CAN->MSR & CAN_MODE_MASK) != 0)
1022   2              {
1023   3                modestatus = CAN_ModeStatus_Failed;
1024   3              }
1025   2              else
1026   2              {
1027   3                modestatus = CAN_ModeStatus_Success;  
1028   3              }
1029   2          }
1030   1          else  if (CAN_OperatingMode == CAN_OperatingMode_Sleep)
1031   1          {
1032   2              /* Request Sleep mode */
1033   2              CAN->MCR = (uint8_t)((uint8_t)(CAN->MCR & (uint8_t)(~CAN_MCR_INRQ)) | CAN_MCR_SLEEP);
1034   2      
1035   2              /* Wait the acknowledge */
1036   2              while (((CAN->MSR & CAN_MODE_MASK) != CAN_MSR_SLAK) && (timeout!=0))
1037   2              {
1038   3                  timeout--;
1039   3              }
1040   2              if ((CAN->MSR & CAN_MODE_MASK) != CAN_MSR_SLAK)
1041   2              {
1042   3                 modestatus = CAN_ModeStatus_Failed;  
1043   3              }
1044   2              else
1045   2              {
1046   3                 modestatus = CAN_ModeStatus_Success;  
1047   3              }
1048   2          }
1049   1          else
1050   1          {
1051   2               modestatus = CAN_ModeStatus_Failed;
1052   2          }
1053   1        return (CAN_ModeStatus_TypeDef)(modestatus);
1054   1      }
1055          
1056          /**
1057            * @brief  Gets the  Last Error Code.
1058            * @param  None
1059            * @retval Error Code.
1060            */
1061          CAN_ErrorCode_TypeDef CAN_GetLastErrorCode(void)
1062          {
1063   1          CAN_ErrorCode_TypeDef errcode = CAN_ErrorCode_NoErr;
1064   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
1065   1      
1066   1          CAN->PSR = CAN_Page_Config;
1067   1          errcode = (CAN_ErrorCode_TypeDef)((CAN->Page.Config.ESR) & (CAN_ESR_LEC));
1068   1      
1069   1          /*Restore Last Page*/
1070   1          CAN_SelectPage(can_page);
1071   1      
1072   1          return (CAN_ErrorCode_TypeDef)(errcode);
1073   1      }
1074          
1075          /**
1076            * @brief  Clears the CAN's pending flags.
1077            * @param   CAN_FLAG : Flag to be cleared, can be one of the following parameters:
1078            *          CAN_FLAG_RQCP0            Request MailBox0  Flag
1079            *          CAN_FLAG_RQCP1            Request MailBox1  Flag
1080            *          CAN_FLAG_RQCP2            Request MailBox2  Flag
1081            *       CAN_FLAG_FF               FIFO Full  Flag
1082            *       CAN_FLAG_FOV              FIFO Overrun  Flag
1083            *       CAN_FLAG_WKU              wake up   Flag
1084            *          CAN_FLAG_LEC               Last error code Flag
1085            * @retval None
1086            */
1087          void CAN_ClearFlag(CAN_FLAG_TypeDef CAN_Flag)
1088          {
1089   1          CAN_Page_TypeDef can_page = (CAN_Page_TypeDef)0;
1090   1          /* Check the parameters */
1091   1          assert_param(IS_CAN_FLAG_CLEAR_OK(CAN_Flag));
1092   1          if (((uint16_t)CAN_Flag & 0x0700)!= RESET)
1093   1          {
1094   2              if (((uint16_t)CAN_Flag & 0x020B)!= RESET)
1095   2              {
1096   3                  /*Receive Flags*/
1097   3                  CAN->RFR = (uint8_t)(CAN_Flag);
1098   3              }
1099   2              else if (((uint16_t)CAN_Flag & 0x0403)!= RESET)
1100   2              {
1101   3                  /*Transmit Flags*/
1102   3                  CAN->TSR = (uint8_t)(CAN_Flag);
1103   3              }
1104   2              else /*if((CAN_Flag & 0x0108)!=(uint16_t)RESET)*/
1105   2              {
1106   3                  /*wake up Flags*/
1107   3                  CAN->MSR = (uint8_t)(CAN_Flag);
1108   3              }
1109   2          }
1110   1          else
1111   1          {
1112   2              /*Error Flags*/
1113   2              can_page = CAN_GetSelectedPage();
1114   2      
1115   2              /* Clear the selected CAN flags */
1116   2              CAN->PSR = CAN_Page_Config;
1117   2              CAN->Page.Config.ESR = (uint8_t)RESET;
1118   2      
1119   2              /*Restore Last Page*/
1120   2              CAN_SelectPage(can_page);
1121   2          }
1122   1      }
1123          
1124          /**
1125            * @brief  Checks whether the specified CAN flag is set or not.
1126            * @param   CAN_FLAG: specifies the flag to check, can be one of @ref CAN_FLAG_TypeDef enumeration.
1127            * @retval The new state of CAN_FLAG which can be one of @ref FlagStatus.
1128            */
1129          FlagStatus CAN_GetFlagStatus(CAN_FLAG_TypeDef CAN_Flag)
1130          {
1131   1          FlagStatus bitstatus = RESET;
1132   1          CAN_Page_TypeDef can_page = (CAN_Page_TypeDef)0;
1133   1      
1134   1          /* Check the parameters */
1135   1          assert_param(IS_CAN_FLAG_STATUS_OK(CAN_Flag));
1136   1      
1137   1          if (((uint16_t)CAN_Flag & 0x0700)!= RESET)
1138   1          {
1139   2              if (((uint16_t)CAN_Flag & 0x020B)!= RESET)
1140   2              {
1141   3                  /*Receive Flags*/
1142   3                  if ((CAN->RFR & (uint16_t)CAN_Flag )!= RESET)
1143   3                  {
1144   4                      /* CAN_FLAG is set */
1145   4                      bitstatus = SET;
1146   4                  }
1147   3                  else
1148   3                  {
1149   4                      /* CAN_FLAG is reset */
1150   4                      bitstatus = RESET;
1151   4                  }
1152   3      
1153   3              }
1154   2              else if (((uint16_t)CAN_Flag & 0x0403)!= RESET)
1155   2              {
1156   3                  /*Transmit Flags*/
1157   3                  if ((CAN->TSR & (uint16_t)CAN_Flag )!= RESET)
1158   3                  {
1159   4                      /* CAN_FLAG is set */
1160   4                      bitstatus = SET;
1161   4                  }
1162   3                  else
1163   3                  {
1164   4                      /* CAN_FLAG is reset */
1165   4                      bitstatus = RESET;
1166   4                  }
1167   3              }
1168   2              else /*if((CAN_Flag & 0x0108)!=(uint16_t)RESET)*/
1169   2              {
1170   3                  /*wake up Flags*/
1171   3                  if ((CAN->MSR & (uint16_t)CAN_Flag )!= RESET)
1172   3                  {
1173   4                      /* CAN_FLAG is set */
1174   4                      bitstatus = SET;
1175   4                  }
1176   3                  else
1177   3                  {
1178   4                      /* CAN_FLAG is reset */
1179   4                      bitstatus = RESET;
1180   4                  }
1181   3              }
1182   2          }
1183   1          else
1184   1          {
1185   2              /*Error Flags*/
1186   2              can_page = CAN_GetSelectedPage();
1187   2      
1188   2              CAN->PSR = CAN_Page_Config;
1189   2              if ((CAN->Page.Config.ESR & (uint16_t)CAN_Flag) != RESET)
1190   2              {
1191   3                  /* CAN_FLAG is set */
1192   3                  bitstatus = SET;
1193   3              }
1194   2              else
1195   2              {
1196   3                  /* CAN_FLAG is reset */
1197   3                  bitstatus = RESET;
1198   3              }
1199   2              /*Restore Last Page*/
1200   2              CAN_SelectPage(can_page);
1201   2          }
1202   1      
1203   1      
1204   1          /* Return the CAN_FLAG status */
1205   1          return  (FlagStatus)bitstatus;
1206   1      }
1207          
1208          /**
1209            * @brief  Checks whether the specified CAN interrupt has occurred or not.
1210            * @param   CAN_IT: specifies the CAN interrupt source to check, can be one of @ref CAN_IT_TypeDef.
1211            * @retval The new state of CAN_IT, which can be one of @ref ITStatus.
1212            */
1213          ITStatus CAN_GetITStatus(CAN_IT_TypeDef CAN_IT)
1214          {
1215   1          ITStatus pendingbitstatus = RESET;
1216   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
1217   1      
1218   1          /* Check the parameters */
1219   1          assert_param(IS_CAN_IT_STATUS_OK(CAN_IT));
1220   1      
1221   1      
1222   1          switch (CAN_IT)
1223   1          {
1224   2          case CAN_IT_TME:
1225   2              if ((CAN->IER & CAN_IER_TMEIE) !=RESET)
1226   2              {
1227   3                  pendingbitstatus = CheckITStatus(CAN->TSR, CAN_TSR_RQCP012);
1228   3              }
1229   2              else
1230   2              {
1231   3                  pendingbitstatus = RESET;
1232   3              }
1233   2              break;
1234   2      
1235   2          case CAN_IT_FMP:
1236   2              if ((CAN->IER & CAN_IER_FMPIE) !=RESET)
1237   2              {
1238   3                  pendingbitstatus = CheckITStatus(CAN->RFR, CAN_RFR_FMP01);
1239   3              }
1240   2              else
1241   2              {
1242   3                  pendingbitstatus = RESET;
1243   3              }
1244   2              break;
1245   2          case CAN_IT_FF:
1246   2              if ((CAN->IER & CAN_IER_FFIE) !=RESET)
1247   2              {
1248   3                  pendingbitstatus = CheckITStatus(CAN->RFR, CAN_RFR_FULL);
1249   3              }
1250   2              else
1251   2              {
1252   3                  pendingbitstatus = RESET;
1253   3              }
1254   2              break;
1255   2          case CAN_IT_FOV:
1256   2              if ((CAN->IER & CAN_IER_FOVIE) !=RESET)
1257   2              {
1258   3                  pendingbitstatus = CheckITStatus(CAN->RFR, CAN_RFR_FOVR);
1259   3              }
1260   2              else
1261   2              {
1262   3                  pendingbitstatus = RESET;
1263   3              }
1264   2              break;
1265   2          case CAN_IT_WKU:
1266   2              if ((CAN->IER & CAN_IER_WKUIE) !=RESET)
1267   2              {
1268   3                  pendingbitstatus = CheckITStatus(CAN->MSR, CAN_MSR_WKUI);
1269   3              }
1270   2              else
1271   2              {
1272   3                  pendingbitstatus = RESET;
1273   3              }
1274   2              break;
1275   2      
1276   2          case CAN_IT_ERR:
1277   2              CAN->PSR = CAN_Page_Config;
1278   2              if ((CAN->Page.Config.EIER & CAN_EIER_ERRIE) !=RESET)
1279   2              {
1280   3                  pendingbitstatus = CheckITStatus(CAN->Page.Config.ESR, CAN_ESR_EWGF|CAN_ESR_EPVF|CAN_ESR_BOFF|CAN_ESR_LEC);
1281   3              }
1282   2              else
1283   2              {
1284   3                  pendingbitstatus = RESET;
1285   3              }
1286   2              break;
1287   2      
1288   2          case CAN_IT_EWG:
1289   2              CAN->PSR = CAN_Page_Config;
1290   2              if ((CAN->Page.Config.EIER & CAN_EIER_EWGIE) !=RESET)
1291   2              {
1292   3                  pendingbitstatus = CheckITStatus(CAN->Page.Config.ESR, CAN_ESR_EWGF);
1293   3              }
1294   2              else
1295   2              {
1296   3                  pendingbitstatus = RESET;
1297   3              }
1298   2              break;
1299   2      
1300   2          case CAN_IT_EPV:
1301   2              CAN->PSR = CAN_Page_Config;
1302   2              if ((CAN->Page.Config.EIER & CAN_EIER_EPVIE) !=RESET)
1303   2              {
1304   3                  pendingbitstatus = CheckITStatus(CAN->Page.Config.ESR, CAN_ESR_EPVF);
1305   3              }
1306   2              else
1307   2              {
1308   3                  pendingbitstatus = RESET;
1309   3              }
1310   2              break;
1311   2          case CAN_IT_BOF:
1312   2              CAN->PSR = CAN_Page_Config;
1313   2              if ((CAN->Page.Config.EIER & CAN_EIER_BOFIE) !=RESET)
1314   2              {
1315   3                  pendingbitstatus = CheckITStatus(CAN->Page.Config.ESR, CAN_ESR_BOFF);
1316   3              }
1317   2              else
1318   2              {
1319   3                  pendingbitstatus = RESET;
1320   3              }
1321   2              break;
1322   2          case CAN_IT_LEC:
1323   2              CAN->PSR = CAN_Page_Config;
1324   2              if ((CAN->Page.Config.EIER & CAN_EIER_LECIE) !=RESET)
1325   2              {
1326   3                  pendingbitstatus = CheckITStatus(CAN->Page.Config.ESR, CAN_ESR_LEC);
1327   3              }
1328   2              else
1329   2              {
1330   3                  pendingbitstatus = RESET;
1331   3              }
1332   2              break;
1333   2          default :
1334   2              pendingbitstatus = RESET;
1335   2              break;
1336   2          }
1337   1          /*Restore Last Page*/
1338   1          CAN_SelectPage(can_page);
1339   1          /* Return the CAN_IT status */
1340   1          return  (ITStatus)pendingbitstatus;
1341   1      }
1342          
1343          /**
1344            * @brief   Clears the CANs interrupt pending bits.
1345            * @param   CAN_IT: specifies the interrupt pending bit to clear,
1346            *  can be one of the following parameters:
1347            *                            CAN_IT_TME = Transmit mailbox empty interrupt
1348            *                             CAN_IT_FF =FIFO  full    interrupt
1349            *                            CAN_IT_FOV =FIFO  overrun  interrupt
1350            *                             CAN_IT_WKU =Wake-up interrupt
1351            *                             CAN_IT_ERR =General Error interrupt
1352            *                             CAN_IT_EWG =Error warning interrupt
1353            *                             CAN_IT_EPV  =Error passive  interrupt
1354            *                             CAN_IT_BOF = Bus-off   interrupt
1355            *                             CAN_IT_LEC  =Last error code interrupt
1356            * @retval None
1357            */
1358          void CAN_ClearITPendingBit(CAN_IT_TypeDef CAN_IT)
1359          {
1360   1          CAN_Page_TypeDef can_page = CAN_GetSelectedPage();
1361   1          /* Check the parameters */
1362   1          assert_param(IS_CAN_IT_PENDING_BIT_OK(CAN_IT));
1363   1      
1364   1          switch (CAN_IT)
1365   1          {
1366   2          case CAN_IT_TME:
1367   2              CAN->TSR = CAN_TSR_RQCP012;/* rc_w1*/
1368   2              break;
1369   2      
1370   2          case CAN_IT_FF:
1371   2              CAN->RFR = CAN_RFR_FULL; /* rc_w1*/
1372   2              break;
1373   2      
1374   2          case CAN_IT_FOV:
1375   2              CAN->RFR = CAN_RFR_FOVR; /* rc_w1*/
1376   2              break;
1377   2      
1378   2          case CAN_IT_WKU:
1379   2              CAN->MSR = CAN_MSR_WKUI;  /* rc_w1*/
1380   2              break;
1381   2      
1382   2          case CAN_IT_ERR:
1383   2              CAN->PSR = CAN_Page_Config;
1384   2              CAN->Page.Config.ESR = (uint8_t)CAN_ESR_RESET_VALUE;
1385   2              CAN->MSR = CAN_MSR_ERRI;
1386   2              break;
1387   2      
1388   2          case CAN_IT_EWG:
1389   2              CAN->MSR = CAN_MSR_ERRI;
1390   2              break;
1391   2      
1392   2          case CAN_IT_EPV:
1393   2              CAN->MSR = CAN_MSR_ERRI;
1394   2              break;
1395   2      
1396   2          case CAN_IT_BOF:
1397   2              CAN->MSR = CAN_MSR_ERRI;
1398   2              break;
1399   2      
1400   2          case CAN_IT_LEC:
1401   2              CAN->PSR = CAN_Page_Config;
1402   2              CAN->Page.Config.ESR = (uint8_t)CAN_ESR_RESET_VALUE;
1403   2              break;
1404   2      
1405   2      
1406   2      
1407   2          default :
1408   2              break;
1409   2          }
1410   1          /*Restore Last Page*/
1411   1          CAN_SelectPage(can_page);
1412   1      }
1413          
1414          /**
1415            * @brief  Gets the selected registers page.
1416            * @param  None
1417            * @retval the selected page which can be one of the @ref CAN_Page_TypeDef.
1418            */
1419          CAN_Page_TypeDef CAN_GetSelectedPage(void)
1420          {
1421   1          return (CAN_Page_TypeDef)(CAN->PSR);
1422   1      }
1423          
1424          /**
1425            * @brief  Sets the registers page to be selected.
1426            * @param   the selected page which can be one of the @ref CAN_Page_TypeDef.
1427            * @retval None
1428            */
1429          void CAN_SelectPage(CAN_Page_TypeDef CAN_Page)
1430          {
1431   1          CAN->PSR = (uint8_t)CAN_Page;
1432   1      }
1433          
1434          /**
1435            * @brief  Checks whether the CAN interrupt has occurred or not.
1436            * @param   CAN_Reg: specifies the CAN interrupt register to check.
1437            * @param   It_Bit: specifies the interrupt source bit to check.
1438            * @retval The new state of the CAN Interrupt, which can be one of ITStatus.
1439            */
1440          static ITStatus CheckITStatus(uint8_t CAN_Reg, uint8_t It_Bit)
1441          {
1442   1          ITStatus pendingbitstatus = RESET;
1443   1          if ((CAN_Reg & It_Bit) != (uint8_t)RESET)
1444   1          {
1445   2              /* CAN_IT is set */
1446   2              pendingbitstatus = SET;
1447   2          }
1448   1          else
1449   1          {
1450   2              /* CAN_IT is reset */
1451   2              pendingbitstatus = RESET;
1452   2          }
1453   1          return (ITStatus)pendingbitstatus;
1454   1      }
1455          
RCSTM8 COMPILER V2.42.12.083
ASSEMBLY LISTING OF GENERATED OBJECT CODE

              ; FUNCTION ?CAN_DeInit (BEGIN)
              ; SOURCE LINE # 42 
0000 35015420                          MOV    05420H,#001H
              ; SOURCE LINE # 43 
0004 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 44 
0008 5F                                CLRW   X
0009 CD0000     F                      CALL   ?CAN_OperatingModeRequest
              ; SOURCE LINE # 45 
000C 725F5428                          CLR    05428H
              ; SOURCE LINE # 46 
0010 725F5429                          CLR    05429H
              ; SOURCE LINE # 47 
0014 3540542C                          MOV    0542CH,#040H
              ; SOURCE LINE # 48 
0018 3523542D                          MOV    0542DH,#023H
              ; SOURCE LINE # 49 
001C 725F5430                          CLR    05430H
              ; SOURCE LINE # 50 
0020 725F5431                          CLR    05431H
              ; SOURCE LINE # 51 
0024 725F5432                          CLR    05432H
              ; SOURCE LINE # 52 
0028 725F5433                          CLR    05433H
              ; SOURCE LINE # 53 
002C 725F5434                          CLR    05434H
              ; SOURCE LINE # 54 
0030 5F                                CLRW   X
0031 5C                                INCW   X
0032 CD0000     F                      CALL   ?CAN_OperatingModeRequest
              ; SOURCE LINE # 55 
0035 35075427                          MOV    05427H,#007H
              ; SOURCE LINE # 56 
0039 725F5429                          CLR    05429H
              ; SOURCE LINE # 57 
003D 725F5427                          CLR    05427H
              ; SOURCE LINE # 58 
0041 725F5429                          CLR    05429H
              ; SOURCE LINE # 59 
0045 35015427                          MOV    05427H,#001H
              ; SOURCE LINE # 60 
0049 725F5429                          CLR    05429H
              ; SOURCE LINE # 61 
004D 35055427                          MOV    05427H,#005H
              ; SOURCE LINE # 62 
0051 725F5429                          CLR    05429H
              ; SOURCE LINE # 64 
0055 35025420                          MOV    05420H,#002H
              ; SOURCE LINE # 65 
0059 35FD5421                          MOV    05421H,#0FDH
              ; SOURCE LINE # 66 
005D 35FF5422                          MOV    05422H,#0FFH
              ; SOURCE LINE # 67 
0061 35FF5424                          MOV    05424H,#0FFH
              ; SOURCE LINE # 68 
0065 725F5425                          CLR    05425H
              ; SOURCE LINE # 69 
0069 350C5426                          MOV    05426H,#00CH
              ; SOURCE LINE # 70 
006D 725F5427                          CLR    05427H
              ; SOURCE LINE # 71 
0071 81                                RET    

              ; FUNCTION ?CAN_DeInit (END)

              ; FUNCTION ?CAN_Init (BEGIN)
              ; Register-parameter CAN_MasterCtrl (XW) is relocated (auto)
              ; SOURCE LINE # 83 
0000 89                                PUSHW  X
0001 5206                              SUB    SP,#006H
              ; SOURCE LINE # 91 
0003 5F                                CLRW   X
0004 5A                                DECW   X
0005 1F03       F                      LDW    (003H,SP),X   ; [ timeout ]
              ; SOURCE LINE # 92 
0007 CD0000     F                      CALL   ?CAN_GetSelectedPage
000A 1F05       F                      LDW    (005H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 96 
000C 1E07       F                      LDW    X,(007H,SP)   ; [ CAN_MasterCtrl ]
000E 2716                              JREQ   ?NXT_0010
0010 A300FC                            CPW    X,#000FCH
0013 2C05                              JRSGT  ?ELSE_0008
0015 A30004                            CPW    X,#00004H
0018 2E0C                              JRSGE  ?NXT_0010
001A         ?ELSE_0008:
001A CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
001D         ?DATASTART_0006:
001D 60                             M  DB     060H
001E         ?DATAEND_0006:
001E AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0021 CD0000     F                      CALL   ?assert_failed
0024 5B04                              ADD    SP,#004H
0026         ?NXT_0010:
              ; SOURCE LINE # 97 
0026 1E0B       F                      LDW    X,(00BH,SP)   ; [ CAN_Mode ]
0028 271B                              JREQ   ?NXT_0011
002A 5A                                DECW   X
002B 2718                              JREQ   ?NXT_0011
002D AE0002                            LDW    X,#00002H
0030 130B       F                      CPW    X,(00BH,SP)   ; [ CAN_Mode ]
0032 2711                              JREQ   ?NXT_0011
0034 5C                                INCW   X
0035 130B       F                      CPW    X,(00BH,SP)   ; [ CAN_Mode ]
0037 270C                              JREQ   ?NXT_0011
0039 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
003C         ?DATASTART_0007:
003C 61                             M  DB     061H
003D         ?DATAEND_0007:
003D AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0040 CD0000     F                      CALL   ?assert_failed
0043 5B04                              ADD    SP,#004H
0045         ?NXT_0011:
              ; SOURCE LINE # 98 
0045 1E0D       F                      LDW    X,(00DH,SP)   ; [ CAN_SynJumpWidth ]
0047 271B                              JREQ   ?NXT_0012
0049 A30040                            CPW    X,#00040H
004C 2716                              JREQ   ?NXT_0012
004E A30080                            CPW    X,#00080H
0051 2711                              JREQ   ?NXT_0012
0053 A300C0                            CPW    X,#000C0H
0056 270C                              JREQ   ?NXT_0012
0058 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
005B         ?DATASTART_0008:
005B 62                             M  DB     062H
005C         ?DATAEND_0008:
005C AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
005F CD0000     F                      CALL   ?assert_failed
0062 5B04                              ADD    SP,#004H
0064         ?NXT_0012:
              ; SOURCE LINE # 99 
0064 AE000F                            LDW    X,#0000FH
0067 130F       F                      CPW    X,(00FH,SP)   ; [ CAN_BitSeg1 ]
0069 2E0C                              JRSGE  ?NXT_0013
006B CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
006E         ?DATASTART_0009:
006E 63                             M  DB     063H
006F         ?DATAEND_0009:
006F AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0072 CD0000     F                      CALL   ?assert_failed
0075 5B04                              ADD    SP,#004H
0077         ?NXT_0013:
              ; SOURCE LINE # 100 
0077 AE0010                            LDW    X,#00010H
007A 1311       F                      CPW    X,(011H,SP)   ; [ CAN_BitSeg2 ]
007C 2C07                              JRSGT  ?LAB_0022
007E AE0070                            LDW    X,#00070H
0081 1311       F                      CPW    X,(011H,SP)   ; [ CAN_BitSeg2 ]
0083 2E10                              JRSGE  ?NXT_0014
0085         ?LAB_0022:
0085 1E11       F                      LDW    X,(011H,SP)   ; [ CAN_BitSeg2 ]
0087 270C                              JREQ   ?NXT_0014
0089 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
008C         ?DATASTART_0010:
008C 64                             M  DB     064H
008D         ?DATAEND_0010:
008D AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0090 CD0000     F                      CALL   ?assert_failed
0093 5B04                              ADD    SP,#004H
0095         ?NXT_0014:
              ; SOURCE LINE # 101 
0095 7B13       F                      LD     A,(013H,SP)   ; [ CAN_Prescaler ]
0097 A101                              CP     A,#001H
0099 2F04                              JRSLT  ?ELSE_0013
009B A140                              CP     A,#040H
009D 2D0C                              JRSLE  ?NXT_0015
009F         ?ELSE_0013:
009F CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
00A2         ?DATASTART_0011:
00A2 65                             M  DB     065H
00A3         ?DATAEND_0011:
00A3 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
00A6 CD0000     F                      CALL   ?assert_failed
00A9 5B04                              ADD    SP,#004H
00AB         ?NXT_0015:
              ; SOURCE LINE # 104 
00AB 35015420                          MOV    05420H,#001H
00AF         ?WHILE_0002:
              ; SOURCE LINE # 106 
00AF C65421                            LD     A,05421H
00B2 A401                              AND    A,#001H
00B4 4A                                DEC    A
00B5 2709                              JREQ   ?NXT_0016
00B7 1E03       F                      LDW    X,(003H,SP)   ; [ timeout ]
00B9 2705                              JREQ   ?NXT_0016
              ; SOURCE LINE # 108 
00BB 5A                                DECW   X
00BC 1F03       F                      LDW    (003H,SP),X   ; [ timeout ]
00BE 20EF                              JRA    ?WHILE_0002
00C0         ?NXT_0016:
              ; SOURCE LINE # 112 
00C0 7200542105                        BTJT   05421H,#000H,?ELSE_0014
              ; SOURCE LINE # 115 
00C5 5F                                CLRW   X
00C6 1F01       F                      LDW    (001H,SP),X   ; [ InitStatus ]
00C8 2044                              JRA    ?NXT_0017
00CA         ?ELSE_0014:
              ; SOURCE LINE # 122 
00CA C65420                            LD     A,05420H
00CD 1A08       F                      OR     A,(008H,SP)   ; [ CAN_MasterCtrl + 01H ]
00CF C75420                            LD     05420H,A
              ; SOURCE LINE # 125 
00D2 C65426                            LD     A,05426H
00D5 1A0C       F                      OR     A,(00CH,SP)   ; [ CAN_Mode + 01H ]
00D7 C75426                            LD     05426H,A
              ; SOURCE LINE # 126 
00DA 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 127 
00DE 7B13       F                      LD     A,(013H,SP)   ; [ CAN_Prescaler ]
00E0 4A                                DEC    A
00E1 1A0E       F                      OR     A,(00EH,SP)   ; [ CAN_SynJumpWidth + 01H ]
00E3 C7542C                            LD     0542CH,A
              ; SOURCE LINE # 128 
00E6 7B12       F                      LD     A,(012H,SP)   ; [ CAN_BitSeg2 + 01H ]
00E8 1A10       F                      OR     A,(010H,SP)   ; [ CAN_BitSeg1 + 01H ]
00EA C7542D                            LD     0542DH,A
              ; SOURCE LINE # 131 
00ED 72115420                          BRES   05420H,#000H
              ; SOURCE LINE # 133 
00F1 5F                                CLRW   X
00F2         ?WHILE_0003:
              ; SOURCE LINE # 134 
00F2 5A                                DECW   X
00F3 1F03       F                      LDW    (003H,SP),X   ; [ timeout ]
00F5 C65421                            LD     A,05421H
00F8 A401                              AND    A,#001H
00FA 4A                                DEC    A
00FB 2603                              JRNE   ?NXT_0018
00FD 5D                                TNZW   X
              ; SOURCE LINE # 136 
00FE 26F2                              JRNE   ?WHILE_0003
0100         ?NXT_0018:
              ; SOURCE LINE # 139 
0100 7201542105                        BTJF   05421H,#000H,?ELSE_0015
              ; SOURCE LINE # 141 
0105 5F                                CLRW   X
0106 1F01       F                      LDW    (001H,SP),X   ; [ InitStatus ]
0108 2004                              JRA    ?NXT_0017
010A         ?ELSE_0015:
              ; SOURCE LINE # 145 
010A 5F                                CLRW   X
010B 5C                                INCW   X
010C 1F01       F                      LDW    (001H,SP),X   ; [ InitStatus ]
010E         ?NXT_0017:
              ; SOURCE LINE # 149 
010E 1E05       F                      LDW    X,(005H,SP)   ; [ can_page ]
0110 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 152 
0113 1E01       F                      LDW    X,(001H,SP)   ; [ InitStatus ]
              ; SOURCE LINE # 153 
0115 5B08                              ADD    SP,#008H
0117 81                                RET    
              ; CAN_MasterCtrl (size=2).  parameter in AUTO
              ; CAN_Mode     (size=2).  parameter in AUTO
              ; CAN_SynJumpWidth (size=2).  parameter in AUTO
              ; CAN_BitSeg1  (size=2).  parameter in AUTO
              ; CAN_BitSeg2  (size=2).  parameter in AUTO
              ; CAN_Prescaler unsigned char  (size=1).  parameter in AUTO
              ; InitStatus   (size=2). Automatic variable  in AUTO
              ; timeout      unsigned short  (size=2-Alg). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_Init (END)

              ; FUNCTION ?CAN_FilterInit (BEGIN)
              ; Register-parameter CAN_FilterNumber (XW) is relocated (auto)
              ; SOURCE LINE # 171 
0000 89                                PUSHW  X
0001 5213                              SUB    SP,#013H
              ; SOURCE LINE # 189 
0003 CD0000     F                      CALL   ?CAN_GetSelectedPage
0006 1F06       F                      LDW    (006H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 192 
0008 1E14       F                      LDW    X,(014H,SP)   ; [ CAN_FilterNumber ]
000A 2725                              JREQ   ?NXT_0051
000C 5A                                DECW   X
000D 2722                              JREQ   ?NXT_0051
000F AE0002                            LDW    X,#00002H
0012 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
0014 271B                              JREQ   ?NXT_0051
0016 5C                                INCW   X
0017 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
0019 2716                              JREQ   ?NXT_0051
001B 5C                                INCW   X
001C 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
001E 2711                              JREQ   ?NXT_0051
0020 5C                                INCW   X
0021 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
0023 270C                              JREQ   ?NXT_0051
0025 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
0028         ?DATASTART_0016:
0028 C0                             M  DB     0C0H
0029         ?DATAEND_0016:
0029 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
002C CD0000     F                      CALL   ?assert_failed
002F 5B04                              ADD    SP,#004H
0031         ?NXT_0051:
              ; SOURCE LINE # 193 
0031 1E18       F                      LDW    X,(018H,SP)   ; [ CAN_FilterActivation ]
0033 270F                              JREQ   ?NXT_0052
0035 5A                                DECW   X
0036 270C                              JREQ   ?NXT_0052
0038 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
003B         ?DATASTART_0017:
003B C1                             M  DB     0C1H
003C         ?DATAEND_0017:
003C AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
003F CD0000     F                      CALL   ?assert_failed
0042 5B04                              ADD    SP,#004H
0044         ?NXT_0052:
              ; SOURCE LINE # 194 
0044 1E1A       F                      LDW    X,(01AH,SP)   ; [ CAN_FilterMode ]
0046 2719                              JREQ   ?NXT_0053
0048 A30010                            CPW    X,#00010H
004B 2714                              JREQ   ?NXT_0053
004D A30011                            CPW    X,#00011H
0050 270F                              JREQ   ?NXT_0053
0052 5A                                DECW   X
0053 270C                              JREQ   ?NXT_0053
0055 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
0058         ?DATASTART_0018:
0058 C2                             M  DB     0C2H
0059         ?DATAEND_0018:
0059 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
005C CD0000     F                      CALL   ?assert_failed
005F 5B04                              ADD    SP,#004H
0061         ?NXT_0053:
              ; SOURCE LINE # 195 
0061 1E1C       F                      LDW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0063 271B                              JREQ   ?NXT_0054
0065 A30002                            CPW    X,#00002H
0068 2716                              JREQ   ?NXT_0054
006A A30004                            CPW    X,#00004H
006D 2711                              JREQ   ?NXT_0054
006F A30006                            CPW    X,#00006H
0072 270C                              JREQ   ?NXT_0054
0074 CD0000     F DNF            M(04)  CALL  ?C?mv4_pg2sk1
0077         ?DATASTART_0019:
0077 C3                             M  DB     0C3H
0078         ?DATAEND_0019:
0078 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
007B CD0000     F                      CALL   ?assert_failed
007E 5B04                              ADD    SP,#004H
0080         ?NXT_0054:
              ; SOURCE LINE # 198 
0080 1E14       F                      LDW    X,(014H,SP)   ; [ CAN_FilterNumber ]
0082 2610                              JRNE   ?ELSE_0050
              ; SOURCE LINE # 200 
0084 AE0100                            LDW    X,#00100H
0087 1F01       F                      LDW    (001H,SP),X   ; [ fact ]
              ; SOURCE LINE # 202 
0089 A603                              LD     A,#003H
008B 6B03       F                      LD     (003H,SP),A   ; [ fmhl ]
              ; SOURCE LINE # 204 
008D AE0002                            LDW    X,#00002H
0090 1F04       F                      LDW    (004H,SP),X   ; [ can_page_filter ]
0092 2069                              JRA    ?NXT_0055
0094         ?ELSE_0050:
              ; SOURCE LINE # 206 
0094 5F                                CLRW   X
0095 5C                                INCW   X
0096 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
0098 2610                              JRNE   ?ELSE_0051
              ; SOURCE LINE # 208 
009A AE1004                            LDW    X,#01004H
009D 1F01       F                      LDW    (001H,SP),X   ; [ fact ]
              ; SOURCE LINE # 210 
009F A60C                              LD     A,#00CH
00A1 6B03       F                      LD     (003H,SP),A   ; [ fmhl ]
              ; SOURCE LINE # 212 
00A3 AE0002                            LDW    X,#00002H
00A6 1F04       F                      LDW    (004H,SP),X   ; [ can_page_filter ]
00A8 2053                              JRA    ?NXT_0055
00AA         ?ELSE_0051:
              ; SOURCE LINE # 214 
00AA AE0002                            LDW    X,#00002H
00AD 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
00AF 2610                              JRNE   ?ELSE_0052
              ; SOURCE LINE # 216 
00B1 AE0100                            LDW    X,#00100H
00B4 1F01       F                      LDW    (001H,SP),X   ; [ fact ]
              ; SOURCE LINE # 218 
00B6 A630                              LD     A,#030H
00B8 6B03       F                      LD     (003H,SP),A   ; [ fmhl ]
              ; SOURCE LINE # 220 
00BA AE0003                            LDW    X,#00003H
00BD 1F04       F                      LDW    (004H,SP),X   ; [ can_page_filter ]
00BF 203C                              JRA    ?NXT_0055
00C1         ?ELSE_0052:
              ; SOURCE LINE # 222 
00C1 AE0003                            LDW    X,#00003H
00C4 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
00C6 2610                              JRNE   ?ELSE_0053
              ; SOURCE LINE # 224 
00C8 AE1004                            LDW    X,#01004H
00CB 1F01       F                      LDW    (001H,SP),X   ; [ fact ]
              ; SOURCE LINE # 226 
00CD A6C0                              LD     A,#0C0H
00CF 6B03       F                      LD     (003H,SP),A   ; [ fmhl ]
              ; SOURCE LINE # 228 
00D1 AE0003                            LDW    X,#00003H
00D4 1F04       F                      LDW    (004H,SP),X   ; [ can_page_filter ]
00D6 2025                              JRA    ?NXT_0055
00D8         ?ELSE_0053:
              ; SOURCE LINE # 230 
00D8 AE0004                            LDW    X,#00004H
00DB 1314       F                      CPW    X,(014H,SP)   ; [ CAN_FilterNumber ]
00DD 2610                              JRNE   ?ELSE_0054
              ; SOURCE LINE # 232 
00DF AE0100                            LDW    X,#00100H
00E2 1F01       F                      LDW    (001H,SP),X   ; [ fact ]
              ; SOURCE LINE # 234 
00E4 A603                              LD     A,#003H
00E6 6B03       F                      LD     (003H,SP),A   ; [ fmhl ]
              ; SOURCE LINE # 236 
00E8 AE0004                            LDW    X,#00004H
00EB 1F04       F                      LDW    (004H,SP),X   ; [ can_page_filter ]
00ED 200E                              JRA    ?NXT_0055
00EF         ?ELSE_0054:
              ; SOURCE LINE # 240 
00EF AE1004                            LDW    X,#01004H
00F2 1F01       F                      LDW    (001H,SP),X   ; [ fact ]
              ; SOURCE LINE # 242 
00F4 A60C                              LD     A,#00CH
00F6 6B03       F                      LD     (003H,SP),A   ; [ fmhl ]
              ; SOURCE LINE # 244 
00F8 AE0004                            LDW    X,#00004H
00FB 1F04       F                      LDW    (004H,SP),X   ; [ can_page_filter ]
00FD         ?NXT_0055:
              ; SOURCE LINE # 248 
00FD 5F                                CLRW   X
00FE CD0000     F                      CALL   ?CAN_OperatingModeRequest
              ; SOURCE LINE # 250 
0101 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 255 
0105 AE0002                            LDW    X,#00002H
0108 1304       F                      CPW    X,(004H,SP)   ; [ can_page_filter ]
010A 2627                              JRNE   ?ELSE_0055
              ; SOURCE LINE # 258 
010C AE0006                            LDW    X,#00006H
010F 7B02       F                      LD     A,(002H,SP)   ; [ fsc ]
0111 CD0000     F                      CALL   ?C?sll168
0114 4F                                CLR    A
0115 95                                LD     XH,A
0116 1F0A       F                      LDW    (00AH,SP),X
0118 7B01       F                      LD     A,(001H,SP)   ; [ fact ]
011A 1A0B       F                      OR     A,(00BH,SP)
011C 43                                CPL    A
011D C45432                            AND    A,05432H
0120 C75432                            LD     05432H,A
              ; SOURCE LINE # 260 
0123 7B02       F                      LD     A,(002H,SP)   ; [ fsc ]
0125 1E1C       F                      LDW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0127 CD0000     F                      CALL   ?C?sll168
012A 9F                                LD     A,XL
012B CA5432                            OR     A,05432H
012E C75432                            LD     05432H,A
0131 204E                              JRA    ?NXT_0060
0133         ?ELSE_0055:
              ; SOURCE LINE # 262 
0133 AE0003                            LDW    X,#00003H
0136 1304       F                      CPW    X,(004H,SP)   ; [ can_page_filter ]
0138 2627                              JRNE   ?ELSE_0056
              ; SOURCE LINE # 265 
013A AE0006                            LDW    X,#00006H
013D 7B02       F                      LD     A,(002H,SP)   ; [ fsc ]
013F CD0000     F                      CALL   ?C?sll168
0142 4F                                CLR    A
0143 95                                LD     XH,A
0144 1F0A       F                      LDW    (00AH,SP),X
0146 7B01       F                      LD     A,(001H,SP)   ; [ fact ]
0148 1A0B       F                      OR     A,(00BH,SP)
014A 43                                CPL    A
014B C45433                            AND    A,05433H
014E C75433                            LD     05433H,A
              ; SOURCE LINE # 268 
0151 7B02       F                      LD     A,(002H,SP)   ; [ fsc ]
0153 1E1C       F                      LDW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0155 CD0000     F                      CALL   ?C?sll168
0158 9F                                LD     A,XL
0159 CA5433                            OR     A,05433H
015C C75433                            LD     05433H,A
015F 2020                              JRA    ?NXT_0060
0161         ?ELSE_0056:
              ; SOURCE LINE # 274 
0161 AE0006                            LDW    X,#00006H
0164 7B02       F                      LD     A,(002H,SP)   ; [ fsc ]
0166 CD0000     F                      CALL   ?C?sll168
0169 9F                                LD     A,XL
016A 1A01       F                      OR     A,(001H,SP)   ; [ fact ]
016C 43                                CPL    A
016D C45434                            AND    A,05434H
0170 C75434                            LD     05434H,A
              ; SOURCE LINE # 277 
0173 7B02       F                      LD     A,(002H,SP)   ; [ fsc ]
0175 1E1C       F                      LDW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0177 CD0000     F                      CALL   ?C?sll168
017A 9F                                LD     A,XL
017B CA5434                            OR     A,05434H
017E C75434                            LD     05434H,A
0181         ?NXT_0060:
              ; SOURCE LINE # 283 
0181 AE0004                            LDW    X,#00004H
0184 1304       F                      CPW    X,(004H,SP)   ; [ can_page_filter ]
0186 273C                              JREQ   ?ELSE_0057
              ; SOURCE LINE # 286 
0188 1E1A       F                      LDW    X,(01AH,SP)   ; [ CAN_FilterMode ]
018A 260B                              JRNE   ?ELSE_0058
              ; SOURCE LINE # 289 
018C 7B03       F                      LD     A,(003H,SP)   ; [ fmhl ]
018E 43                                CPL    A
018F C45430                            AND    A,05430H
0192 C75430                            LD     05430H,A
0195 2067                              JRA    ?NXT_0062
0197         ?ELSE_0058:
              ; SOURCE LINE # 291 
0197 5F                                CLRW   X
0198 5C                                INCW   X
0199 131A       F                      CPW    X,(01AH,SP)   ; [ CAN_FilterMode ]
019B 260A                              JRNE   ?ELSE_0059
              ; SOURCE LINE # 294 
019D C65430                            LD     A,05430H
01A0 1A03       F                      OR     A,(003H,SP)   ; [ fmhl ]
01A2 C75430                            LD     05430H,A
01A5 2057                              JRA    ?NXT_0062
01A7         ?ELSE_0059:
              ; SOURCE LINE # 296 
01A7 AE0011                            LDW    X,#00011H
01AA 7B03       F                      LD     A,(003H,SP)   ; [ fmhl ]
01AC 131A       F                      CPW    X,(01AH,SP)   ; [ CAN_FilterMode ]
01AE 260A                              JRNE   ?ELSE_0060
              ; SOURCE LINE # 299 
01B0 A455                              AND    A,#055H
01B2 CA5430                            OR     A,05430H
01B5 C75430                            LD     05430H,A
01B8 2044                              JRA    ?NXT_0062
01BA         ?ELSE_0060:
              ; SOURCE LINE # 304 
01BA A4AA                              AND    A,#0AAH
01BC CA5430                            OR     A,05430H
01BF C75430                            LD     05430H,A
01C2 203A                              JRA    ?NXT_0062
01C4         ?ELSE_0057:
              ; SOURCE LINE # 313 
01C4 1E1A       F                      LDW    X,(01AH,SP)   ; [ CAN_FilterMode ]
01C6 260B                              JRNE   ?ELSE_0061
              ; SOURCE LINE # 316 
01C8 7B03       F                      LD     A,(003H,SP)   ; [ fmhl ]
01CA 43                                CPL    A
01CB C45431                            AND    A,05431H
01CE C75431                            LD     05431H,A
01D1 202B                              JRA    ?NXT_0062
01D3         ?ELSE_0061:
              ; SOURCE LINE # 318 
01D3 5F                                CLRW   X
01D4 5C                                INCW   X
01D5 131A       F                      CPW    X,(01AH,SP)   ; [ CAN_FilterMode ]
01D7 260A                              JRNE   ?ELSE_0062
              ; SOURCE LINE # 321 
01D9 C65431                            LD     A,05431H
01DC 1A03       F                      OR     A,(003H,SP)   ; [ fmhl ]
01DE C75431                            LD     05431H,A
01E1 201B                              JRA    ?NXT_0062
01E3         ?ELSE_0062:
              ; SOURCE LINE # 323 
01E3 AE0011                            LDW    X,#00011H
01E6 7B03       F                      LD     A,(003H,SP)   ; [ fmhl ]
01E8 131A       F                      CPW    X,(01AH,SP)   ; [ CAN_FilterMode ]
01EA 260A                              JRNE   ?ELSE_0063
              ; SOURCE LINE # 326 
01EC A455                              AND    A,#055H
01EE CA5431                            OR     A,05431H
01F1 C75431                            LD     05431H,A
01F4 2008                              JRA    ?NXT_0062
01F6         ?ELSE_0063:
              ; SOURCE LINE # 331 
01F6 A4AA                              AND    A,#0AAH
01F8 CA5431                            OR     A,05431H
01FB C75431                            LD     05431H,A
01FE         ?NXT_0062:
              ; SOURCE LINE # 337 
01FE 7B05       F                      LD     A,(005H,SP)   ; [ can_page_filter + 01H ]
0200 C75427                            LD     05427H,A
              ; SOURCE LINE # 338 
0203 0D02       F                      TNZ    (002H,SP)   ; [ fsc ]
0205 2603                              JRNE   ?LAB_0050
0207 CC0000     F                      JP     ?ELSE_0064
020A         ?LAB_0050:
              ; SOURCE LINE # 341 
020A 1E1C       F                      LDW    X,(01CH,SP)   ; [ CAN_FilterScale ]
020C 262B                              JRNE   ?ELSE_0065
              ; SOURCE LINE # 343 
020E 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
0210 C75430                            LD     05430H,A
              ; SOURCE LINE # 344 
0213 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
0215 C75431                            LD     05431H,A
              ; SOURCE LINE # 345 
0218 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
021A C75432                            LD     05432H,A
              ; SOURCE LINE # 346 
021D 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
021F C75433                            LD     05433H,A
              ; SOURCE LINE # 347 
0222 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
0224 C75434                            LD     05434H,A
              ; SOURCE LINE # 348 
0227 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
0229 C75435                            LD     05435H,A
              ; SOURCE LINE # 349 
022C 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
022E C75436                            LD     05436H,A
              ; SOURCE LINE # 350 
0231 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
0233 C75437                            LD     05437H,A
0236 CC0000     F                      JP     ?NXT_0069
0239         ?ELSE_0065:
              ; SOURCE LINE # 352 
0239 AE0002                            LDW    X,#00002H
023C 131C       F                      CPW    X,(01CH,SP)   ; [ CAN_FilterScale ]
023E 262B                              JRNE   ?ELSE_0066
              ; SOURCE LINE # 354 
0240 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
0242 C75430                            LD     05430H,A
              ; SOURCE LINE # 355 
0245 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
0247 C75431                            LD     05431H,A
              ; SOURCE LINE # 356 
024A 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
024C C75432                            LD     05432H,A
              ; SOURCE LINE # 357 
024F 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
0251 C75433                            LD     05433H,A
              ; SOURCE LINE # 358 
0254 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
0256 C75434                            LD     05434H,A
              ; SOURCE LINE # 359 
0259 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
025B C75435                            LD     05435H,A
              ; SOURCE LINE # 360 
025E 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
0260 C75436                            LD     05436H,A
              ; SOURCE LINE # 361 
0263 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
0265 C75437                            LD     05437H,A
0268 CC0000     F                      JP     ?NXT_0069
026B         ?ELSE_0066:
              ; SOURCE LINE # 363 
026B AE0004                            LDW    X,#00004H
026E 131C       F                      CPW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0270 262B                              JRNE   ?ELSE_0067
              ; SOURCE LINE # 365 
0272 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
0274 C75430                            LD     05430H,A
              ; SOURCE LINE # 366 
0277 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
0279 C75431                            LD     05431H,A
              ; SOURCE LINE # 367 
027C 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
027E C75432                            LD     05432H,A
              ; SOURCE LINE # 368 
0281 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
0283 C75433                            LD     05433H,A
              ; SOURCE LINE # 369 
0286 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
0288 C75434                            LD     05434H,A
              ; SOURCE LINE # 370 
028B 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
028D C75435                            LD     05435H,A
              ; SOURCE LINE # 371 
0290 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
0292 C75436                            LD     05436H,A
              ; SOURCE LINE # 372 
0295 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
0297 C75437                            LD     05437H,A
029A CC0000     F                      JP     ?NXT_0069
029D         ?ELSE_0067:
              ; SOURCE LINE # 374 
029D AE0006                            LDW    X,#00006H
02A0 131C       F                      CPW    X,(01CH,SP)   ; [ CAN_FilterScale ]
02A2 2703                              JREQ   ?LAB_0051
02A4 CC0000     F                      JP     ?NXT_0069
02A7         ?LAB_0051:
              ; SOURCE LINE # 376 
02A7 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
02A9 C75430                            LD     05430H,A
              ; SOURCE LINE # 377 
02AC 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
02AE C75431                            LD     05431H,A
              ; SOURCE LINE # 378 
02B1 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
02B3 C75432                            LD     05432H,A
              ; SOURCE LINE # 379 
02B6 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
02B8 C75433                            LD     05433H,A
              ; SOURCE LINE # 380 
02BB 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
02BD C75434                            LD     05434H,A
              ; SOURCE LINE # 381 
02C0 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
02C2 C75435                            LD     05435H,A
              ; SOURCE LINE # 382 
02C5 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
02C7 C75436                            LD     05436H,A
              ; SOURCE LINE # 383 
02CA 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
02CC C75437                            LD     05437H,A
02CF CC0000     F                      JP     ?NXT_0069
02D2         ?ELSE_0064:
              ; SOURCE LINE # 389 
02D2 1E1C       F                      LDW    X,(01CH,SP)   ; [ CAN_FilterScale ]
02D4 262B                              JRNE   ?ELSE_0069
              ; SOURCE LINE # 391 
02D6 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
02D8 C75428                            LD     05428H,A
              ; SOURCE LINE # 392 
02DB 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
02DD C75429                            LD     05429H,A
              ; SOURCE LINE # 393 
02E0 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
02E2 C7542A                            LD     0542AH,A
              ; SOURCE LINE # 394 
02E5 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
02E7 C7542B                            LD     0542BH,A
              ; SOURCE LINE # 395 
02EA 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
02EC C7542C                            LD     0542CH,A
              ; SOURCE LINE # 396 
02EF 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
02F1 C7542D                            LD     0542DH,A
              ; SOURCE LINE # 397 
02F4 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
02F6 C7542E                            LD     0542EH,A
              ; SOURCE LINE # 398 
02F9 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
02FB C7542F                            LD     0542FH,A
02FE CC0000     F                      JP     ?NXT_0069
0301         ?ELSE_0069:
              ; SOURCE LINE # 400 
0301 AE0002                            LDW    X,#00002H
0304 131C       F                      CPW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0306 262A                              JRNE   ?ELSE_0070
              ; SOURCE LINE # 402 
0308 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
030A C75428                            LD     05428H,A
              ; SOURCE LINE # 403 
030D 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
030F C75429                            LD     05429H,A
              ; SOURCE LINE # 404 
0312 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
0314 C7542A                            LD     0542AH,A
              ; SOURCE LINE # 405 
0317 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
0319 C7542B                            LD     0542BH,A
              ; SOURCE LINE # 406 
031C 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
031E C7542C                            LD     0542CH,A
              ; SOURCE LINE # 407 
0321 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
0323 C7542D                            LD     0542DH,A
              ; SOURCE LINE # 408 
0326 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
0328 C7542E                            LD     0542EH,A
              ; SOURCE LINE # 409 
032B 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
032D C7542F                            LD     0542FH,A
0330 2060                              JRA    ?NXT_0069
0332         ?ELSE_0070:
              ; SOURCE LINE # 411 
0332 AE0004                            LDW    X,#00004H
0335 131C       F                      CPW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0337 262A                              JRNE   ?ELSE_0071
              ; SOURCE LINE # 413 
0339 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
033B C75428                            LD     05428H,A
              ; SOURCE LINE # 414 
033E 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
0340 C75429                            LD     05429H,A
              ; SOURCE LINE # 415 
0343 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
0345 C7542A                            LD     0542AH,A
              ; SOURCE LINE # 416 
0348 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
034A C7542B                            LD     0542BH,A
              ; SOURCE LINE # 417 
034D 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
034F C7542C                            LD     0542CH,A
              ; SOURCE LINE # 418 
0352 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
0354 C7542D                            LD     0542DH,A
              ; SOURCE LINE # 419 
0357 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
0359 C7542E                            LD     0542EH,A
              ; SOURCE LINE # 420 
035C 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
035E C7542F                            LD     0542FH,A
0361 202F                              JRA    ?NXT_0069
0363         ?ELSE_0071:
              ; SOURCE LINE # 422 
0363 AE0006                            LDW    X,#00006H
0366 131C       F                      CPW    X,(01CH,SP)   ; [ CAN_FilterScale ]
0368 2628                              JRNE   ?NXT_0069
              ; SOURCE LINE # 424 
036A 7B1E       F                      LD     A,(01EH,SP)   ; [ CAN_FilterID1 ]
036C C75428                            LD     05428H,A
              ; SOURCE LINE # 425 
036F 7B1F       F                      LD     A,(01FH,SP)   ; [ CAN_FilterID2 ]
0371 C75429                            LD     05429H,A
              ; SOURCE LINE # 426 
0374 7B20       F                      LD     A,(020H,SP)   ; [ CAN_FilterID3 ]
0376 C7542A                            LD     0542AH,A
              ; SOURCE LINE # 427 
0379 7B21       F                      LD     A,(021H,SP)   ; [ CAN_FilterID4 ]
037B C7542B                            LD     0542BH,A
              ; SOURCE LINE # 428 
037E 7B22       F                      LD     A,(022H,SP)   ; [ CAN_FilterIDMask1 ]
0380 C7542C                            LD     0542CH,A
              ; SOURCE LINE # 429 
0383 7B23       F                      LD     A,(023H,SP)   ; [ CAN_FilterIDMask2 ]
0385 C7542D                            LD     0542DH,A
              ; SOURCE LINE # 430 
0388 7B24       F                      LD     A,(024H,SP)   ; [ CAN_FilterIDMask3 ]
038A C7542E                            LD     0542EH,A
              ; SOURCE LINE # 431 
038D 7B25       F                      LD     A,(025H,SP)   ; [ CAN_FilterIDMask4 ]
038F C7542F                            LD     0542FH,A
0392         ?NXT_0069:
              ; SOURCE LINE # 440 
0392 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 441 
0396 1E18       F                      LDW    X,(018H,SP)   ; [ CAN_FilterActivation ]
0398 272A                              JREQ   ?NXT_0078
              ; SOURCE LINE # 443 
039A A606                              LD     A,#006H
039C 1515       F                      BCP    A,(015H,SP)   ; [ CAN_FilterNumber + 01H ]
039E 260A                              JRNE   ?ELSE_0074
              ; SOURCE LINE # 444 
03A0 C65432                            LD     A,05432H
03A3 1A01       F                      OR     A,(001H,SP)   ; [ fact ]
03A5 C75432                            LD     05432H,A
03A8 201A                              JRA    ?NXT_0078
03AA         ?ELSE_0074:
              ; SOURCE LINE # 446 
03AA A606                              LD     A,#006H
03AC 1415       F                      AND    A,(015H,SP)   ; [ CAN_FilterNumber + 01H ]
03AE A102                              CP     A,#002H
03B0 260A                              JRNE   ?ELSE_0075
              ; SOURCE LINE # 447 
03B2 C65433                            LD     A,05433H
03B5 1A01       F                      OR     A,(001H,SP)   ; [ fact ]
03B7 C75433                            LD     05433H,A
03BA 2008                              JRA    ?NXT_0078
03BC         ?ELSE_0075:
              ; SOURCE LINE # 450 
03BC C65434                            LD     A,05434H
03BF 1A01       F                      OR     A,(001H,SP)   ; [ fact ]
03C1 C75434                            LD     05434H,A
03C4         ?NXT_0078:
              ; SOURCE LINE # 453 
03C4 5F                                CLRW   X
03C5 5C                                INCW   X
03C6 CD0000     F                      CALL   ?CAN_OperatingModeRequest
              ; SOURCE LINE # 455 
03C9 1E06       F                      LDW    X,(006H,SP)   ; [ can_page ]
03CB CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 456 
03CE 5B15                              ADD    SP,#015H
03D0 81                                RET    
              ; CAN_FilterNumber (size=2).  parameter in AUTO
              ; CAN_FilterActivation (size=2).  parameter in AUTO
              ; CAN_FilterMode (size=2).  parameter in AUTO
              ; CAN_FilterScale (size=2).  parameter in AUTO
              ; CAN_FilterID1 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterID2 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterID3 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterID4 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterIDMask1 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterIDMask2 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterIDMask3 unsigned char  (size=1).  parameter in AUTO
              ; CAN_FilterIDMask4 unsigned char  (size=1).  parameter in AUTO
              ; fact         unsigned char  (size=1). Automatic variable  in AUTO
              ; fsc          unsigned char  (size=1). Automatic variable  in AUTO
              ; fmhl         unsigned char  (size=1). Automatic variable  in AUTO
              ; can_page_filter (size=2). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_FilterInit (END)

              ; FUNCTION ?CAN_ITConfig (BEGIN)
              ; Register-parameter CAN_IT (XW) is relocated (auto)
              ; SOURCE LINE # 464 
0000 89                                PUSHW  X
0001 5203                              SUB    SP,#003H
              ; SOURCE LINE # 467 
0003 CD0000     F                      CALL   ?CAN_GetSelectedPage
0006 1F02       F                      LDW    (002H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 471 
0008 1E04       F                      LDW    X,(004H,SP)   ; [ CAN_IT ]
000A 2710                              JREQ   ?ELSE_0079
000C 7B05       F                      LD     A,(005H,SP)   ; [ CAN_IT + 01H ]
000E A470                              AND    A,#070H
0010 B704       F                      LD     ?BL,A
0012 7B04       F                      LD     A,(004H,SP)   ; [ CAN_IT ]
0014 A4B0                              AND    A,#0B0H
0016 B703       F                      LD     ?BH,A
0018 BE02       F                      LDW    X,?BH.w
001A 270E                              JREQ   ?NXT_0085
001C         ?ELSE_0079:
001C AE01D7                            LDW    X,#001D7H
001F 89                                PUSHW  X
0020 5F                                CLRW   X
0021 89                                PUSHW  X
0022 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0025 CD0000     F                      CALL   ?assert_failed
0028 5B04                              ADD    SP,#004H
002A         ?NXT_0085:
              ; SOURCE LINE # 472 
002A 1E08       F                      LDW    X,(008H,SP)   ; [ NewState ]
002C 2711                              JREQ   ?NXT_0086
002E 5A                                DECW   X
002F 270E                              JREQ   ?NXT_0086
0031 AE01D8                            LDW    X,#001D8H
0034 89                                PUSHW  X
0035 5F                                CLRW   X
0036 89                                PUSHW  X
0037 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
003A CD0000     F                      CALL   ?assert_failed
003D 5B04                              ADD    SP,#004H
003F         ?NXT_0086:
              ; SOURCE LINE # 474 
003F 1E04       F                      LDW    X,(004H,SP)   ; [ CAN_IT ]
0041 54                                SRLW   X
0042 54                                SRLW   X
0043 54                                SRLW   X
0044 54                                SRLW   X
0045 54                                SRLW   X
0046 54                                SRLW   X
0047 54                                SRLW   X
0048 9F                                LD     A,XL
0049 6B01       F                      LD     (001H,SP),A   ; [ tmperrorinterrupt ]
              ; SOURCE LINE # 476 
004B A40F                              AND    A,#00FH
004D 44                                SRL    A
004E B706       F                      LD     ?CL,A
0050 7B01       F                      LD     A,(001H,SP)   ; [ tmperrorinterrupt ]
0052 A4F0                              AND    A,#0F0H
0054 BA06       F                      OR     A,?CL
0056 6B01       F                      LD     (001H,SP),A   ; [ tmperrorinterrupt ]
              ; SOURCE LINE # 478 
0058 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 479 
005C 1E08       F                      LDW    X,(008H,SP)   ; [ NewState ]
005E 270F                              JREQ   ?ELSE_0081
              ; SOURCE LINE # 482 
0060 C65425                            LD     A,05425H
0063 1A05       F                      OR     A,(005H,SP)   ; [ CAN_IT + 01H ]
0065 C75425                            LD     05425H,A
              ; SOURCE LINE # 483 
0068 C65429                            LD     A,05429H
006B 1A01       F                      OR     A,(001H,SP)   ; [ tmperrorinterrupt ]
006D 200F                              JRA    ?NXT_0087
006F         ?ELSE_0081:
              ; SOURCE LINE # 488 
006F 7B05       F                      LD     A,(005H,SP)   ; [ CAN_IT + 01H ]
0071 43                                CPL    A
0072 C45425                            AND    A,05425H
0075 C75425                            LD     05425H,A
              ; SOURCE LINE # 489 
0078 7B01       F                      LD     A,(001H,SP)   ; [ tmperrorinterrupt ]
007A 43                                CPL    A
007B C45429                            AND    A,05429H
007E         ?NXT_0087:
007E C75429                            LD     05429H,A
              ; SOURCE LINE # 492 
0081 1E02       F                      LDW    X,(002H,SP)   ; [ can_page ]
0083 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 493 
0086 5B05                              ADD    SP,#005H
0088 81                                RET    
              ; CAN_IT       (size=2).  parameter in AUTO
              ; NewState     (size=2).  parameter in AUTO
              ; tmperrorinterrupt unsigned char  (size=1). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_ITConfig (END)

              ; FUNCTION ?CAN_ST7CompatibilityCmd (BEGIN)
              ; Register-parameter CAN_ST7Compatibility (XW) is relocated (auto)
              ; SOURCE LINE # 502 
0000 89                                PUSHW  X
              ; SOURCE LINE # 505 
0001 5D                                TNZW   X
0002 2713                              JREQ   ?NXT_0089
0004 A30010                            CPW    X,#00010H
0007 270E                              JREQ   ?NXT_0089
0009 AE01F9                            LDW    X,#001F9H
000C 89                                PUSHW  X
000D 5F                                CLRW   X
000E 89                                PUSHW  X
000F AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0012 CD0000     F                      CALL   ?assert_failed
0015 5B04                              ADD    SP,#004H
0017         ?NXT_0089:
              ; SOURCE LINE # 507 
0017 72195426                          BRES   05426H,#004H
              ; SOURCE LINE # 510 
001B C65426                            LD     A,05426H
001E 1A02       F                      OR     A,(002H,SP)   ; [ CAN_ST7Compatibility + 01H ]
0020 C75426                            LD     05426H,A
              ; SOURCE LINE # 511 
0023 85                                POPW   X
0024 81                                RET    
              ; CAN_ST7Compatibility (size=2).  parameter in AUTO

              ; FUNCTION ?CAN_ST7CompatibilityCmd (END)

              ; FUNCTION ?CAN_TTComModeCmd (BEGIN)
              ; Register-parameter NewState (XW) is relocated (auto)
              ; SOURCE LINE # 518 
0000 89                                PUSHW  X
0001 89                                PUSHW  X
              ; SOURCE LINE # 520 
0002 CD0000     F                      CALL   ?CAN_GetSelectedPage
0005 1F01       F                      LDW    (001H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 522 
0007 1E03       F                      LDW    X,(003H,SP)   ; [ NewState ]
0009 2711                              JREQ   ?NXT_0092
000B 5A                                DECW   X
000C 270E                              JREQ   ?NXT_0092
000E AE020A                            LDW    X,#0020AH
0011 89                                PUSHW  X
0012 5F                                CLRW   X
0013 89                                PUSHW  X
0014 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0017 CD0000     F                      CALL   ?assert_failed
001A 5B04                              ADD    SP,#004H
001C         ?NXT_0092:
              ; SOURCE LINE # 523 
001C 1E03       F                      LDW    X,(003H,SP)   ; [ NewState ]
001E 2726                              JREQ   ?ELSE_0087
              ; SOURCE LINE # 526 
0020 721E5420                          BSET   05420H,#007H
              ; SOURCE LINE # 528 
0024 725F5427                          CLR    05427H
              ; SOURCE LINE # 529 
0028 721E5429                          BSET   05429H,#007H
              ; SOURCE LINE # 530 
002C 35015427                          MOV    05427H,#001H
              ; SOURCE LINE # 531 
0030 721E5429                          BSET   05429H,#007H
              ; SOURCE LINE # 532 
0034 35055427                          MOV    05427H,#005H
              ; SOURCE LINE # 533 
0038 721E5429                          BSET   05429H,#007H
              ; SOURCE LINE # 534 
003C 35075427                          MOV    05427H,#007H
              ; SOURCE LINE # 535 
0040 721E5429                          BSET   05429H,#007H
0044 2024                              JRA    ?NXT_0093
0046         ?ELSE_0087:
              ; SOURCE LINE # 540 
0046 721F5420                          BRES   05420H,#007H
              ; SOURCE LINE # 542 
004A 725F5427                          CLR    05427H
              ; SOURCE LINE # 543 
004E 721F5429                          BRES   05429H,#007H
              ; SOURCE LINE # 544 
0052 35015427                          MOV    05427H,#001H
              ; SOURCE LINE # 545 
0056 721F5429                          BRES   05429H,#007H
              ; SOURCE LINE # 546 
005A 35055427                          MOV    05427H,#005H
              ; SOURCE LINE # 547 
005E 721F5429                          BRES   05429H,#007H
              ; SOURCE LINE # 548 
0062 35075427                          MOV    05427H,#007H
              ; SOURCE LINE # 549 
0066 721F5429                          BRES   05429H,#007H
006A         ?NXT_0093:
              ; SOURCE LINE # 552 
006A 1E01       F                      LDW    X,(001H,SP)   ; [ can_page ]
006C CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 553 
006F 5B04                              ADD    SP,#004H
0071 81                                RET    
              ; NewState     (size=2).  parameter in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_TTComModeCmd (END)

              ; FUNCTION ?CAN_Transmit (BEGIN)
              ; SOURCE LINE # 564 
0000 5204                              SUB    SP,#004H
              ; SOURCE LINE # 570 
0002 AE00F4                            LDW    X,#000F4H
0005 1F01       F                      LDW    (001H,SP),X   ; [ CAN_TxStatus ]
              ; SOURCE LINE # 571 
0007 CD0000     F                      CALL   ?CAN_GetSelectedPage
000A 1F03       F                      LDW    (003H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 573 
000C 1E0B       F                      LDW    X,(00BH,SP)   ; [ CAN_IDE ]
000E 2713                              JREQ   ?NXT_0105
0010 A30040                            CPW    X,#00040H
0013 270E                              JREQ   ?NXT_0105
0015 AE023D                            LDW    X,#0023DH
0018 89                                PUSHW  X
0019 5F                                CLRW   X
001A 89                                PUSHW  X
001B AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
001E CD0000     F                      CALL   ?assert_failed
0021 5B04                              ADD    SP,#004H
0023         ?NXT_0105:
              ; SOURCE LINE # 574 
0023 1E0B       F                      LDW    X,(00BH,SP)   ; [ CAN_IDE ]
0025 2720                              JREQ   ?ELSE_0100
              ; SOURCE LINE # 576 
0027 CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
002A         ?DATASTART_0024:
002A 1F                             M  DB     01FH
002B FF                             M  DB     0FFH
002C FF                             M  DB     0FFH
002D FF                             M  DB     0FFH
002E         ?DATAEND_0024:
002E 96           DNF                  LDW    X,SP
002F 1C0007     F                      ADDW   X,#00007H
0032 CD0000     F                      CALL   ?C?cpu3232ix
0035 242E                              JRUGE  ?NXT_0106
0037 AE0240                            LDW    X,#00240H
003A 89                                PUSHW  X
003B 5F                                CLRW   X
003C 89                                PUSHW  X
003D AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0040 CD0000     F                      CALL   ?assert_failed
0043 5B04                              ADD    SP,#004H
0045 201E                              JRA    ?NXT_0106
0047         ?ELSE_0100:
              ; SOURCE LINE # 580 
0047 CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
004A         ?DATASTART_0025:
004A 00                             M  DB     000H
004B 00                             M  DB     000H
004C 07                             M  DB     007H
004D FF                             M  DB     0FFH
004E         ?DATAEND_0025:
004E 96           DNF                  LDW    X,SP
004F 1C0007     F                      ADDW   X,#00007H
0052 CD0000     F                      CALL   ?C?cpu3232ix
0055 240E                              JRUGE  ?NXT_0106
0057 AE0244                            LDW    X,#00244H
005A 89                                PUSHW  X
005B 5F                                CLRW   X
005C 89                                PUSHW  X
005D AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0060 CD0000     F                      CALL   ?assert_failed
0063 5B04                              ADD    SP,#004H
0065         ?NXT_0106:
              ; SOURCE LINE # 582 
0065 1E0D       F                      LDW    X,(00DH,SP)   ; [ CAN_RTR ]
0067 2713                              JREQ   ?NXT_0109
0069 A30020                            CPW    X,#00020H
006C 270E                              JREQ   ?NXT_0109
006E AE0246                            LDW    X,#00246H
0071 89                                PUSHW  X
0072 5F                                CLRW   X
0073 89                                PUSHW  X
0074 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0077 CD0000     F                      CALL   ?assert_failed
007A 5B04                              ADD    SP,#004H
007C         ?NXT_0109:
              ; SOURCE LINE # 583 
007C 7B0F       F                      LD     A,(00FH,SP)   ; [ CAN_DLC ]
007E A108                              CP     A,#008H
0080 2D0E                              JRSLE  ?NXT_0110
0082 AE0247                            LDW    X,#00247H
0085 89                                PUSHW  X
0086 5F                                CLRW   X
0087 89                                PUSHW  X
0088 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
008B CD0000     F                      CALL   ?assert_failed
008E 5B04                              ADD    SP,#004H
0090         ?NXT_0110:
              ; SOURCE LINE # 585 
0090 7205542305                        BTJF   05423H,#002H,?ELSE_0105
              ; SOURCE LINE # 587 
0095 5F                                CLRW   X
0096 1F01       F                      LDW    (001H,SP),X   ; [ CAN_TxStatus ]
0098 201C                              JRA    ?NXT_0111
009A         ?ELSE_0105:
              ; SOURCE LINE # 589 
009A 7207542306                        BTJF   05423H,#003H,?ELSE_0106
              ; SOURCE LINE # 591 
009F 5F                                CLRW   X
00A0 5C                                INCW   X
00A1 1F01       F                      LDW    (001H,SP),X   ; [ CAN_TxStatus ]
00A3 2011                              JRA    ?NXT_0111
00A5         ?ELSE_0106:
              ; SOURCE LINE # 593 
00A5 7209542307                        BTJF   05423H,#004H,?ELSE_0107
              ; SOURCE LINE # 595 
00AA AE0005                            LDW    X,#00005H
00AD 1F01       F                      LDW    (001H,SP),X   ; [ CAN_TxStatus ]
00AF 2005                              JRA    ?NXT_0111
00B1         ?ELSE_0107:
              ; SOURCE LINE # 599 
00B1 AE00F4                            LDW    X,#000F4H
00B4 1F01       F                      LDW    (001H,SP),X   ; [ CAN_TxStatus ]
00B6         ?NXT_0111:
              ; SOURCE LINE # 601 
00B6 AE00F4                            LDW    X,#000F4H
00B9 1301       F                      CPW    X,(001H,SP)   ; [ CAN_TxStatus ]
00BB 2603                              JRNE   ?LAB_0064
00BD CC0000     F                      JP     ?NXT_0114
00C0         ?LAB_0064:
              ; SOURCE LINE # 603 
00C0 7B02       F                      LD     A,(002H,SP)   ; [ CAN_TxStatus + 01H ]
00C2 C75427                            LD     05427H,A
              ; SOURCE LINE # 605 
00C5 1E0B       F                      LDW    X,(00BH,SP)   ; [ CAN_IDE ]
00C7 2773                              JREQ   ?ELSE_0109
              ; SOURCE LINE # 607 
00C9 1E09       F                      LDW    X,(009H,SP)   ; [ CAN_Id + 02H ]
00CB 89                                PUSHW  X
00CC 1E09       F                      LDW    X,(009H,SP)   ; [ CAN_Id ]
00CE 89                                PUSHW  X
00CF CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
00D2         ?DATASTART_0026:
00D2 1F                             M  DB     01FH
00D3 FF                             M  DB     0FFH
00D4 FF                             M  DB     0FFH
00D5 FF                             M  DB     0FFH
00D6         ?DATAEND_0026:
00D6 CD0000     F DNF                  CALL   ?C?and3232
00D9 A606       F                      LD     A,#006H
00DB CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 608 
00DE 7B0A       F                      LD     A,(00AH,SP)   ; [ CAN_Id + 03H ]
00E0 C7542D                            LD     0542DH,A
              ; SOURCE LINE # 609 
00E3 A606       F                      LD     A,#006H
00E5 CD0000     F DNF                  CALL   ?C?mv4_isa2bc
00E8 A608                              LD     A,#008H
00EA CD0000     F                      CALL   ?C?srl328
00ED A606       F                      LD     A,#006H
00EF CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 610 
00F2 7B0A       F                      LD     A,(00AH,SP)   ; [ CAN_Id + 03H ]
00F4 C7542C                            LD     0542CH,A
              ; SOURCE LINE # 611 
00F7 A606       F                      LD     A,#006H
00F9 CD0000     F DNF                  CALL   ?C?mv4_isa2bc
00FC A608                              LD     A,#008H
00FE CD0000     F                      CALL   ?C?srl328
0101 A606       F                      LD     A,#006H
0103 CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 612 
0106 7B0A       F                      LD     A,(00AH,SP)   ; [ CAN_Id + 03H ]
0108 C7542B                            LD     0542BH,A
              ; SOURCE LINE # 613 
010B A606       F                      LD     A,#006H
010D CD0000     F DNF                  CALL   ?C?mv4_isa2bc
0110 A608                              LD     A,#008H
0112 CD0000     F                      CALL   ?C?srl328
0115 A606       F                      LD     A,#006H
0117 CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 614 
011A 1E0B       F                      LDW    X,(00BH,SP)   ; [ CAN_IDE ]
011C CD0000     F                      CALL   ?C?inttol
011F CD0000     F DNF                  CALL   ?C?mv4_bc2sk
0122 A60A       F                      LD     A,#00AH
0124 CD0000     F DNF                  CALL   ?C?mv4_isa2bc
0127 CD0000     F DNF                  CALL   ?C?or3232
012A CD0000     F DNF                  CALL   ?C?mv4_bc2sk
012D 1E11       F                      LDW    X,(011H,SP)   ; [ CAN_RTR ]
012F CD0000     F                      CALL   ?C?inttol
0132 CD0000     F DNF                  CALL   ?C?or3232
0135 550006542A F                      MOV    0542AH,?CL
013A 2039                              JRA    ?NXT_0115
013C         ?ELSE_0109:
              ; SOURCE LINE # 618 
013C 1E09       F                      LDW    X,(009H,SP)   ; [ CAN_Id + 02H ]
013E 89                                PUSHW  X
013F 1E09       F                      LDW    X,(009H,SP)   ; [ CAN_Id ]
0141 89                                PUSHW  X
0142 CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
0145         ?DATASTART_0027:
0145 00                             M  DB     000H
0146 00                             M  DB     000H
0147 07                             M  DB     007H
0148 FF                             M  DB     0FFH
0149         ?DATAEND_0027:
0149 CD0000     F DNF                  CALL   ?C?and3232
014C A606       F                      LD     A,#006H
014E CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 619 
0151 A606                              LD     A,#006H
0153 CD0000     F                      CALL   ?C?srl328
0156 CD0000     F DNF                  CALL   ?C?mv4_bc2sk
0159 1E11       F                      LDW    X,(011H,SP)   ; [ CAN_RTR ]
015B CD0000     F                      CALL   ?C?inttol
015E CD0000     F DNF                  CALL   ?C?or3232
0161 550006542A F                      MOV    0542AH,?CL
              ; SOURCE LINE # 620 
0166 A606       F                      LD     A,#006H
0168 CD0000     F DNF                  CALL   ?C?mv4_isa2bc
016B A602                              LD     A,#002H
016D CD0000     F                      CALL   ?C?sll328
0170 550006542B F                      MOV    0542BH,?CL
0175         ?NXT_0115:
              ; SOURCE LINE # 624 
0175 A6F0                              LD     A,#0F0H
0177 C45429                            AND    A,05429H
017A C75429                            LD     05429H,A
              ; SOURCE LINE # 626 
017D C65429                            LD     A,05429H
0180 1A0F       F                      OR     A,(00FH,SP)   ; [ CAN_DLC ]
0182 C75429                            LD     05429H,A
              ; SOURCE LINE # 628 
0185 1E10       F                      LDW    X,(010H,SP)   ; [ CAN_Data ]
0187 F6                                LD     A,(X)
0188 C7542E                            LD     0542EH,A
              ; SOURCE LINE # 629 
018B E601                              LD     A,(001H,X)
018D C7542F                            LD     0542FH,A
              ; SOURCE LINE # 630 
0190 E602                              LD     A,(002H,X)
0192 C75430                            LD     05430H,A
              ; SOURCE LINE # 631 
0195 E603                              LD     A,(003H,X)
0197 C75431                            LD     05431H,A
              ; SOURCE LINE # 632 
019A E604                              LD     A,(004H,X)
019C C75432                            LD     05432H,A
              ; SOURCE LINE # 633 
019F E605                              LD     A,(005H,X)
01A1 C75433                            LD     05433H,A
              ; SOURCE LINE # 634 
01A4 E606                              LD     A,(006H,X)
01A6 C75434                            LD     05434H,A
              ; SOURCE LINE # 635 
01A9 E607                              LD     A,(007H,X)
01AB C75435                            LD     05435H,A
              ; SOURCE LINE # 637 
01AE 72105428                          BSET   05428H,#000H
01B2         ?NXT_0114:
              ; SOURCE LINE # 640 
01B2 1E03       F                      LDW    X,(003H,SP)   ; [ can_page ]
01B4 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 642 
01B7 5F                                CLRW   X
01B8 CD0000     F                      CALL   ?CAN_TransmitStatus
              ; SOURCE LINE # 645 
01BB 5B04                              ADD    SP,#004H
01BD 81                                RET    
              ; CAN_Id       unsigned long  (size=4-Alg).  parameter in AUTO
              ; CAN_IDE      (size=2).  parameter in AUTO
              ; CAN_RTR      (size=2).  parameter in AUTO
              ; CAN_DLC      unsigned char  (size=1).  parameter in AUTO
              ; CAN_Data     pointer to (unsigned char   in )(size=2).  parameter in AUTO
              ; CAN_TxStatus (size=2). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_Transmit (END)

              ; FUNCTION ?CAN_TransmitStatus (BEGIN)
              ; Register-parameter CAN_TransmitMailbox (XW) is relocated (auto)
              ; SOURCE LINE # 652 
0000 89                                PUSHW  X
0001 5203                              SUB    SP,#003H
              ; SOURCE LINE # 659 
0003 1E04       F                      LDW    X,(004H,SP)   ; [ CAN_TransmitMailbox ]
0005 2718                              JREQ   ?NXT_0119
0007 5A                                DECW   X
0008 2715                              JREQ   ?NXT_0119
000A AE0005                            LDW    X,#00005H
000D 1304       F                      CPW    X,(004H,SP)   ; [ CAN_TransmitMailbox ]
000F 270E                              JREQ   ?NXT_0119
0011 AE0293                            LDW    X,#00293H
0014 89                                PUSHW  X
0015 5F                                CLRW   X
0016 89                                PUSHW  X
0017 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
001A CD0000     F                      CALL   ?assert_failed
001D 5B04                              ADD    SP,#004H
001F         ?NXT_0119:
              ; SOURCE LINE # 661 
001F 1E04       F                      LDW    X,(004H,SP)   ; [ CAN_TransmitMailbox ]
0021 271B                              JREQ   ?CASE_0007
0023 A30001                            CPW    X,#00001H
0026 2724                              JREQ   ?CASE_0008
0028 A30005                            CPW    X,#00005H
002B 262D                              JRNE   ?DEFAULT_0002
002D C65422                            LD     A,05422H
0030 A444                              AND    A,#044H
0032 44                                SRL    A
0033 44                                SRL    A
0034 6B03       F                      LD     (003H,SP),A   ; [ tmpstate ]
0036 C65423                            LD     A,05423H
0039 A410                              AND    A,#010H
003B 44                                SRL    A
003C 201B                              JRA    ?CASE_0009
003E         ?CASE_0007:
              ; SOURCE LINE # 663 
003E C65422                            LD     A,05422H
0041 A411                              AND    A,#011H
0043 6B03       F                      LD     (003H,SP),A   ; [ tmpstate ]
              ; SOURCE LINE # 664 
0045 C65423                            LD     A,05423H
0048 A404                              AND    A,#004H
              ; SOURCE LINE # 665 
004A 200E                              JRA    ?NXT_0120
004C         ?CASE_0008:
              ; SOURCE LINE # 666 
004C C65422                            LD     A,05422H
004F A422                              AND    A,#022H
0051 44                                SRL    A
0052 6B03       F                      LD     (003H,SP),A   ; [ tmpstate ]
              ; SOURCE LINE # 667 
0054 C65423                            LD     A,05423H
0057 A408                              AND    A,#008H
0059         ?CASE_0009:
              ; SOURCE LINE # 669 
0059 44                                SRL    A
005A         ?DEFAULT_0002:

005A         ?NXT_0120:
              ; SOURCE LINE # 674 
005A 1A03       F                      OR     A,(003H,SP)   ; [ tmpstate ]
005C 6B03       F                      LD     (003H,SP),A   ; [ tmpstate ]
              ; SOURCE LINE # 677 
005E 2711                              JREQ   ?CASE_0010
0060 A104                              CP     A,#004H
0062 2717                              JREQ   ?CASE_0011
0064 A105                              CP     A,#005H
0066 270E                              JREQ   ?CASE_0012
0068 A115                              CP     A,#015H
006A 2614                              JRNE   ?DEFAULT_0003
006C AE00F1                            LDW    X,#000F1H
006F 2012                              JRA    ?NXT_0121
0071         ?CASE_0010:
              ; SOURCE LINE # 680 
0071 AE00F2                            LDW    X,#000F2H
              ; SOURCE LINE # 681 
0074 200D                              JRA    ?NXT_0121
0076         ?CASE_0012:
              ; SOURCE LINE # 683 
0076 AE00F0                            LDW    X,#000F0H
              ; SOURCE LINE # 684 
0079 2008                              JRA    ?NXT_0121
007B         ?CASE_0011:
              ; SOURCE LINE # 689 
007B AE00F5                            LDW    X,#000F5H
              ; SOURCE LINE # 690 
007E 2003                              JRA    ?NXT_0121
0080         ?DEFAULT_0003:
              ; SOURCE LINE # 692 
0080 AE00F0                            LDW    X,#000F0H
0083         ?NXT_0121:
              ; SOURCE LINE # 697 
0083 5B05                              ADD    SP,#005H
0085 81                                RET    
              ; CAN_TransmitMailbox (size=2).  parameter in AUTO
              ; tstate       (size=2). Automatic variable  in AUTO
              ; tmpstate     unsigned char  (size=1). Automatic variable  in AUTO

              ; FUNCTION ?CAN_TransmitStatus (END)

              ; FUNCTION ?CAN_CancelTransmit (BEGIN)
              ; Register-parameter CAN_TransmitMailbox (XW) is relocated (auto)
              ; SOURCE LINE # 704 
0000 89                                PUSHW  X
0001 89                                PUSHW  X
              ; SOURCE LINE # 706 
0002 CD0000     F                      CALL   ?CAN_GetSelectedPage
0005 1F01       F                      LDW    (001H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 708 
0007 1E03       F                      LDW    X,(003H,SP)   ; [ CAN_TransmitMailbox ]
0009 2718                              JREQ   ?NXT_0123
000B 5A                                DECW   X
000C 2715                              JREQ   ?NXT_0123
000E AE0005                            LDW    X,#00005H
0011 1303       F                      CPW    X,(003H,SP)   ; [ CAN_TransmitMailbox ]
0013 270E                              JREQ   ?NXT_0123
0015 AE02C4                            LDW    X,#002C4H
0018 89                                PUSHW  X
0019 5F                                CLRW   X
001A 89                                PUSHW  X
001B AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
001E CD0000     F                      CALL   ?assert_failed
0021 5B04                              ADD    SP,#004H
0023         ?NXT_0123:
              ; SOURCE LINE # 710 
0023 7B04       F                      LD     A,(004H,SP)   ; [ CAN_TransmitMailbox + 01H ]
0025 C75427                            LD     05427H,A
              ; SOURCE LINE # 712 
0028 72125428                          BSET   05428H,#001H
              ; SOURCE LINE # 714 
002C 1E01       F                      LDW    X,(001H,SP)   ; [ can_page ]
002E CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 715 
0031 5B04                              ADD    SP,#004H
0033 81                                RET    
              ; CAN_TransmitMailbox (size=2).  parameter in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_CancelTransmit (END)

              ; FUNCTION ?CAN_FIFORelease (BEGIN)
              ; SOURCE LINE # 725 
0000 35205424                          MOV    05424H,#020H
              ; SOURCE LINE # 726 
0004 81                                RET    

              ; FUNCTION ?CAN_FIFORelease (END)

              ; FUNCTION ?CAN_MessagePending (BEGIN)
              ; SOURCE LINE # 735 
0000 C65424                            LD     A,05424H
0003 5F                                CLRW   X
0004 A403                              AND    A,#003H
0006 97                                LD     XL,A
              ; SOURCE LINE # 737 
0007 81                                RET    
              ; msgpending   (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_MessagePending (END)

              ; FUNCTION ?CAN_Receive (BEGIN)
              ; SOURCE LINE # 747 
0000 520E                              SUB    SP,#00EH
              ; SOURCE LINE # 749 
0002 CD0000     F                      CALL   ?CAN_GetSelectedPage
0005 1F01       F                      LDW    (001H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 750 
0007 5F                                CLRW   X
0008 1F03       F                      LDW    (003H,SP),X   ; [ temp1 ]
000A 1F05       F                      LDW    (005H,SP),X   ; [ temp1 + 02H ]
000C 1F07       F                      LDW    (007H,SP),X   ; [ temp2 ]
000E 1F09       F                      LDW    (009H,SP),X   ; [ temp2 + 02H ]
0010 1F0B       F                      LDW    (00BH,SP),X   ; [ temp3 ]
0012 1F0D       F                      LDW    (00DH,SP),X   ; [ temp3 + 02H ]
              ; SOURCE LINE # 753 
0014 35075427                          MOV    05427H,#007H
              ; SOURCE LINE # 756 
0018 C6542A                            LD     A,0542AH
001B A440                              AND    A,#040H
001D B700       F                      LD     _IDE,A
              ; SOURCE LINE # 757 
001F 275F                              JREQ   ?ELSE_0117
              ; SOURCE LINE # 759 
0021 C6542C                            LD     A,0542CH
0024 CD0000     F                      CALL   ?C?uchartol
0027 A608                              LD     A,#008H
0029 CD0000     F                      CALL   ?C?sll328
002C A602       F                      LD     A,#002H
002E CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 760 
0031 C6542B                            LD     A,0542BH
0034 CD0000     F                      CALL   ?C?uchartol
0037 A610                              LD     A,#010H
0039 CD0000     F                      CALL   ?C?sll328
003C A606       F                      LD     A,#006H
003E CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 761 
0041 C6542A                            LD     A,0542AH
0044 CD0000     F                      CALL   ?C?uchartol
0047 A61F                              LD     A,#01FH
0049 B406       F                      AND    A,?CL
004B CD0000     F                      CALL   ?C?uchartol
004E A618                              LD     A,#018H
0050 CD0000     F                      CALL   ?C?sll328
0053 A60A       F                      LD     A,#00AH
0055 CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 763 
0058 5F                                CLRW   X
0059 5A                                DECW   X
005A 89                                PUSHW  X
005B AE1FFF                            LDW    X,#01FFFH
005E 89                                PUSHW  X
005F 1E09       F                      LDW    X,(009H,SP)   ; [ temp1 + 02H ]
0061 89                                PUSHW  X
0062 1E09       F                      LDW    X,(009H,SP)   ; [ temp1 ]
0064 89                                PUSHW  X
0065 C6542D                            LD     A,0542DH
0068 CD0000     F                      CALL   ?C?uchartol
006B CD0000     F DNF                  CALL   ?C?or3232
006E CD0000     F DNF                  CALL   ?C?mv4_bc2sk
0071 A60E       F                      LD     A,#00EH
0073 CD0000     F DNF                  CALL   ?C?mv4_isa2bc
0076 CD0000     F DNF                  CALL   ?C?or3232
0079 CD0000     F DNF                  CALL   ?C?mv4_bc2sk
007C A612       F                      LD     A,#012H
007E 2034                              JRA    ?NXT_0127
0080         ?ELSE_0117:
              ; SOURCE LINE # 767 
0080 C6542A                            LD     A,0542AH
0083 A41F                              AND    A,#01FH
0085 5F                                CLRW   X
0086 97                                LD     XL,A
0087 58                                SLAW   X
0088 58                                SLAW   X
0089 58                                SLAW   X
008A 58                                SLAW   X
008B 58                                SLAW   X
008C 58                                SLAW   X
008D BF03       F                      LDW    ?CH,X
008F 5F                                CLRW   X
0090 BF03       F                      LDW    ?BH,X
0092 A602       F                      LD     A,#002H
0094 CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 768 
0097 C6542B                            LD     A,0542BH
009A 44                                SRL    A
009B 44                                SRL    A
009C A43F                              AND    A,#03FH
009E CD0000     F                      CALL   ?C?uchartol
00A1 A606       F                      LD     A,#006H
00A3 CD0000     F                      CALL   ?C?mv4_bc2isa
              ; SOURCE LINE # 770 
00A6 AE07FF                            LDW    X,#007FFH
00A9 89                                PUSHW  X
00AA 5F                                CLRW   X
00AB 89                                PUSHW  X
00AC 1E0D       F                      LDW    X,(00DH,SP)   ; [ temp2 + 02H ]
00AE 89                                PUSHW  X
00AF 1E0D       F                      LDW    X,(00DH,SP)   ; [ temp2 ]
00B1 89                                PUSHW  X
00B2 A60A       F                      LD     A,#00AH
00B4         ?NXT_0127:
00B4 CD0000     F DNF                  CALL   ?C?mv4_isa2bc
00B7 CD0000     F DNF                  CALL   ?C?or3232
00BA CD0000     F DNF                  CALL   ?C?and3232
00BD AE0000     F                      LDW    X,#HIGH(_Id)
00C0 CD0000     F                      CALL   ?C?mv4_bc2ix
              ; SOURCE LINE # 773 
00C3 C6542A                            LD     A,0542AH
00C6 A420                              AND    A,#020H
00C8 B700       F                      LD     _RTR,A
              ; SOURCE LINE # 776 
00CA C65429                            LD     A,05429H
00CD A40F                              AND    A,#00FH
00CF B700       F                      LD     _DLC,A
              ; SOURCE LINE # 779 
00D1 5554280000 F                      MOV    _FMI,05428H
              ; SOURCE LINE # 782 
00D6 55542E0000 F                      MOV    _Data,0542EH
              ; SOURCE LINE # 783 
00DB 55542F0000 F                      MOV    _Data + 01H,0542FH
              ; SOURCE LINE # 784 
00E0 5554300000 F                      MOV    _Data + 02H,05430H
              ; SOURCE LINE # 785 
00E5 5554310000 F                      MOV    _Data + 03H,05431H
              ; SOURCE LINE # 786 
00EA 5554320000 F                      MOV    _Data + 04H,05432H
              ; SOURCE LINE # 787 
00EF 5554330000 F                      MOV    _Data + 05H,05433H
              ; SOURCE LINE # 788 
00F4 5554340000 F                      MOV    _Data + 06H,05434H
              ; SOURCE LINE # 789 
00F9 5554350000 F                      MOV    _Data + 07H,05435H
              ; SOURCE LINE # 792 
00FE CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
0101         ?DATASTART_0031:
0101 00                             M  DB     000H
0102 00                             M  DB     000H
0103 07                             M  DB     007H
0104 28                             M  DB     028H
0105         ?DATAEND_0031:
0105 AE0000     F                      LDW    X,#HIGH(_Id)
0108 CD0000     F                      CALL   ?C?cpu3232ix
010B 270F                              JREQ   ?LAB_0090
010D CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
0110         ?DATASTART_0032:
0110 00                             M  DB     000H
0111 00                             M  DB     000H
0112 07                             M  DB     007H
0113 E8                             M  DB     0E8H
0114         ?DATAEND_0032:
0114 AE0000     F                      LDW    X,#HIGH(_Id)
0117 CD0000     F                      CALL   ?C?cpu3232ix
011A 2618                              JRNE   ?NXT_0128
011C         ?LAB_0090:
              ; SOURCE LINE # 794 
011C 450000     F                      MOV    l_can_data,_Data
              ; SOURCE LINE # 795 
011F 450000     F                      MOV    l_can_data + 01H,_Data + 01H
              ; SOURCE LINE # 796 
0122 450000     F                      MOV    l_can_data + 02H,_Data + 02H
              ; SOURCE LINE # 797 
0125 450000     F                      MOV    l_can_data + 03H,_Data + 03H
              ; SOURCE LINE # 798 
0128 450000     F                      MOV    l_can_data + 04H,_Data + 04H
              ; SOURCE LINE # 799 
012B 450000     F                      MOV    l_can_data + 05H,_Data + 05H
              ; SOURCE LINE # 800 
012E 450000     F                      MOV    l_can_data + 06H,_Data + 06H
              ; SOURCE LINE # 801 
0131 450000     F                      MOV    l_can_data + 07H,_Data + 07H
0134         ?NXT_0128:
              ; SOURCE LINE # 808 
0134 35010000   F                      MOV    l_can_receive_flag,#001H
              ; SOURCE LINE # 809 
0138 CD0000     F DNF            M(07)  CALL  ?C?mv4_pg2bc
013B         ?DATASTART_0033:
013B 00                             M  DB     000H
013C 00                             M  DB     000H
013D 07                             M  DB     007H
013E DF                             M  DB     0DFH
013F         ?DATAEND_0033:
013F AE0000     F                      LDW    X,#HIGH(_Id)
0142 CD0000     F                      CALL   ?C?cpu3232ix
0145 260F                              JRNE   ?ELSE_0119
0147 3D00       F                      TNZ    Timeout_EOL_Flag
0149 2705                              JREQ   ?LAB_0091
014B B600       F                      LD     A,Tester_Present
014D 4A                                DEC    A
014E 2606                              JRNE   ?ELSE_0119
0150         ?LAB_0091:
              ; SOURCE LINE # 811 
0150 35010000   F                      MOV    Tester_Present,#001H
0154 2002                              JRA    ?NXT_0129
0156         ?ELSE_0119:
              ; SOURCE LINE # 815 
0156 3F00       F                      CLR    Tester_Present
0158         ?NXT_0129:
              ; SOURCE LINE # 819 
0158 CD0000     F                      CALL   ?CAN_FIFORelease
              ; SOURCE LINE # 821 
015B 1E01       F                      LDW    X,(001H,SP)   ; [ can_page ]
015D CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 823 
0160 5B0E                              ADD    SP,#00EH
0162 81                                RET    
              ; can_page     (size=2). Automatic variable  in AUTO
              ; temp1        unsigned long  (size=4-Alg). Automatic variable  in AUTO
              ; temp2        unsigned long  (size=4-Alg). Automatic variable  in AUTO
              ; temp3        unsigned long  (size=4-Alg). Automatic variable  in AUTO

              ; FUNCTION ?CAN_Receive (END)

              ; FUNCTION ?CAN_GetReceivedId (BEGIN)
              ; SOURCE LINE # 835 
0000 AE0000     F                      LDW    X,#_Id
0003 CC0000     F                      JP     ?C?mv4_ix2bc

              ; FUNCTION ?CAN_GetReceivedId (END)

              ; FUNCTION ?CAN_GetReceivedIDE (BEGIN)
              ; SOURCE LINE # 848 
0000 B600       F                      LD     A,_IDE
0002 5F                                CLRW   X
0003 97                                LD     XL,A
              ; SOURCE LINE # 849 
0004 81                                RET    

              ; FUNCTION ?CAN_GetReceivedIDE (END)

              ; FUNCTION ?CAN_GetReceivedRTR (BEGIN)
              ; SOURCE LINE # 861 
0000 B600       F                      LD     A,_RTR
0002 5F                                CLRW   X
0003 97                                LD     XL,A
              ; SOURCE LINE # 862 
0004 81                                RET    

              ; FUNCTION ?CAN_GetReceivedRTR (END)

              ; FUNCTION ?CAN_GetReceivedDLC (BEGIN)
              ; SOURCE LINE # 874 
0000 B600       F                      LD     A,_DLC
              ; SOURCE LINE # 875 
0002 81                                RET    

              ; FUNCTION ?CAN_GetReceivedDLC (END)

              ; FUNCTION ?CAN_GetReceivedData (BEGIN)
              ; Register-parameter CAN_DataIndex (A) is relocated (auto)
              ; SOURCE LINE # 886 
0000 88                                PUSH   A
              ; SOURCE LINE # 888 
0001 A108                              CP     A,#008H
0003 2D0E                              JRSLE  ?NXT_0131
0005 AE0378                            LDW    X,#00378H
0008 89                                PUSHW  X
0009 5F                                CLRW   X
000A 89                                PUSHW  X
000B AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
000E CD0000     F                      CALL   ?assert_failed
0011 5B04                              ADD    SP,#004H
0013         ?NXT_0131:
              ; SOURCE LINE # 889 
0013 7B01       F                      LD     A,(001H,SP)   ; [ CAN_DataIndex ]
0015 5F                                CLRW   X
0016 97                                LD     XL,A
0017 E607       F                      LD     A,(_Data + 00H,X)
              ; SOURCE LINE # 890 
0019 5B01                              ADD    SP,#001H
001B 81                                RET    
              ; CAN_DataIndex unsigned char  (size=1).  parameter in AUTO

              ; FUNCTION ?CAN_GetReceivedData (END)

              ; FUNCTION ?CAN_GetReceivedFMI (BEGIN)
              ; SOURCE LINE # 902 
0000 B600       F                      LD     A,_FMI
              ; SOURCE LINE # 903 
0002 81                                RET    

              ; FUNCTION ?CAN_GetReceivedFMI (END)

              ; FUNCTION ?CAN_GetMessageTimeStamp (BEGIN)
              ; SOURCE LINE # 910 
0000 5204                              SUB    SP,#004H
              ; SOURCE LINE # 913 
0002 CD0000     F                      CALL   ?CAN_GetSelectedPage
0005 1F03       F                      LDW    (003H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 916 
0007 35075427                          MOV    05427H,#007H
              ; SOURCE LINE # 918 
000B C65436                            LD     A,05436H
000E 5F                                CLRW   X
000F 97                                LD     XL,A
0010 1F01       F                      LDW    (001H,SP),X   ; [ timestamp ]
              ; SOURCE LINE # 919 
0012 C65437                            LD     A,05437H
0015 97                                LD     XL,A
0016 4F                                CLR    A
0017 02                                RLWA   X,A
0018 7B02       F                      LD     A,(002H,SP)   ; [ timestamp + 01H ]
001A B704       F                      LD     ?BL,A
001C 9E                                LD     A,XH
001D 1A01       F                      OR     A,(001H,SP)   ; [ timestamp ]
001F B703       F                      LD     ?BH,A
0021 BE02       F                      LDW    X,?BH.w
0023 1F01       F                      LDW    (001H,SP),X   ; [ timestamp ]
              ; SOURCE LINE # 922 
0025 1E03       F                      LDW    X,(003H,SP)   ; [ can_page ]
0027 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 924 
002A 1E01       F                      LDW    X,(001H,SP)   ; [ timestamp ]
              ; SOURCE LINE # 925 
002C 5B04                              ADD    SP,#004H
002E 81                                RET    
              ; timestamp    unsigned short  (size=2-Alg). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_GetMessageTimeStamp (END)

              ; FUNCTION ?CAN_Sleep (BEGIN)
              ; SOURCE LINE # 935 
0000 5F                                CLRW   X
0001 89                                PUSHW  X
              ; SOURCE LINE # 938 
0002 C65420                            LD     A,05420H
0005 A4FE                              AND    A,#0FEH
0007 AA02                              OR     A,#002H
0009 C75420                            LD     05420H,A
              ; SOURCE LINE # 941 
000C A603                              LD     A,#003H
000E C45421                            AND    A,05421H
0011 A102                              CP     A,#002H
0013 2603                              JRNE   ?NXT_0133
              ; SOURCE LINE # 944 
0015 5C                                INCW   X
0016 1F01       F                      LDW    (001H,SP),X   ; [ sleepstatus ]
0018         ?NXT_0133:
              ; SOURCE LINE # 949 
0018 85                                POPW   X
0019 81                                RET    
              ; sleepstatus  (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_Sleep (END)

              ; FUNCTION ?CAN_WakeUp (BEGIN)
              ; SOURCE LINE # 958 
0000 5F                                CLRW   X
0001 89                                PUSHW  X
              ; SOURCE LINE # 961 
0002 72135420                          BRES   05420H,#001H
              ; SOURCE LINE # 964 
0006 7202542103                        BTJT   05421H,#001H,?NXT_0135
              ; SOURCE LINE # 967 
000B 5C                                INCW   X
000C 1F01       F                      LDW    (001H,SP),X   ; [ wakeupstatus ]
000E         ?NXT_0135:
              ; SOURCE LINE # 972 
000E 85                                POPW   X
000F 81                                RET    
              ; wakeupstatus (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_WakeUp (END)

              ; FUNCTION ?CAN_OperatingModeRequest (BEGIN)
              ; Register-parameter CAN_OperatingMode (XW) is relocated (auto)
              ; SOURCE LINE # 983 
0000 89                                PUSHW  X
0001 5203                              SUB    SP,#003H
              ; SOURCE LINE # 986 
0003 5F                                CLRW   X
0004 5A                                DECW   X
0005 1F01       F                      LDW    (001H,SP),X   ; [ timeout ]
              ; SOURCE LINE # 989 
0007 1E04       F                      LDW    X,(004H,SP)   ; [ CAN_OperatingMode ]
0009 2718                              JREQ   ?NXT_0147
000B 5A                                DECW   X
000C 2715                              JREQ   ?NXT_0147
000E AE0002                            LDW    X,#00002H
0011 1304       F                      CPW    X,(004H,SP)   ; [ CAN_OperatingMode ]
0013 270E                              JREQ   ?NXT_0147
0015 AE03DD                            LDW    X,#003DDH
0018 89                                PUSHW  X
0019 5F                                CLRW   X
001A 89                                PUSHW  X
001B AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
001E CD0000     F                      CALL   ?assert_failed
0021 5B04                              ADD    SP,#004H
0023         ?NXT_0147:
              ; SOURCE LINE # 991 
0023 1E04       F                      LDW    X,(004H,SP)   ; [ CAN_OperatingMode ]
0025 262D                              JRNE   ?ELSE_0134
              ; SOURCE LINE # 994 
0027 C65420                            LD     A,05420H
002A A4FD                              AND    A,#0FDH
002C AA01                              OR     A,#001H
002E C75420                            LD     05420H,A
0031         ?WHILE_0007:
              ; SOURCE LINE # 997 
0031 A603                              LD     A,#003H
0033 C45421                            AND    A,05421H
0036 4A                                DEC    A
0037 2709                              JREQ   ?NXT_0149
0039 1E01       F                      LDW    X,(001H,SP)   ; [ timeout ]
003B 2705                              JREQ   ?NXT_0149
              ; SOURCE LINE # 999 
003D 5A                                DECW   X
003E 1F01       F                      LDW    (001H,SP),X   ; [ timeout ]
0040 20EF                              JRA    ?WHILE_0007
0042         ?NXT_0149:
              ; SOURCE LINE # 1001 
0042 A603                              LD     A,#003H
0044 C45421                            AND    A,05421H
0047 4A                                DEC    A
0048 2704                              JREQ   ?ELSE_0135
              ; SOURCE LINE # 1003 
004A 0F03       F                      CLR    (003H,SP)   ; [ modestatus ]
004C 206D                              JRA    ?NXT_0148
004E         ?ELSE_0135:
              ; SOURCE LINE # 1007 
004E A601                              LD     A,#001H
0050 6B03       F                      LD     (003H,SP),A   ; [ modestatus ]
0052 2067                              JRA    ?NXT_0148
0054         ?ELSE_0134:
              ; SOURCE LINE # 1011 
0054 5F                                CLRW   X
0055 5C                                INCW   X
0056 1304       F                      CPW    X,(004H,SP)   ; [ CAN_OperatingMode ]
0058 2629                              JRNE   ?ELSE_0136
              ; SOURCE LINE # 1014 
005A A6FC                              LD     A,#0FCH
005C C45420                            AND    A,05420H
005F C75420                            LD     05420H,A
0062         ?WHILE_0008:
              ; SOURCE LINE # 1017 
0062 A603                              LD     A,#003H
0064 C55421                            BCP    A,05421H
0067 2709                              JREQ   ?NXT_0152
0069 1E01       F                      LDW    X,(001H,SP)   ; [ timeout ]
006B 2705                              JREQ   ?NXT_0152
              ; SOURCE LINE # 1019 
006D 5A                                DECW   X
006E 1F01       F                      LDW    (001H,SP),X   ; [ timeout ]
0070 20F0                              JRA    ?WHILE_0008
0072         ?NXT_0152:
              ; SOURCE LINE # 1021 
0072 A603                              LD     A,#003H
0074 C55421                            BCP    A,05421H
0077 2704                              JREQ   ?ELSE_0137
              ; SOURCE LINE # 1023 
0079 0F03       F                      CLR    (003H,SP)   ; [ modestatus ]
007B 203E                              JRA    ?NXT_0148
007D         ?ELSE_0137:
              ; SOURCE LINE # 1027 
007D A601                              LD     A,#001H
007F 6B03       F                      LD     (003H,SP),A   ; [ modestatus ]
0081 2038                              JRA    ?NXT_0148
0083         ?ELSE_0136:
              ; SOURCE LINE # 1030 
0083 AE0002                            LDW    X,#00002H
0086 1304       F                      CPW    X,(004H,SP)   ; [ CAN_OperatingMode ]
0088 262F                              JRNE   ?ELSE_0138
              ; SOURCE LINE # 1033 
008A C65420                            LD     A,05420H
008D A4FE                              AND    A,#0FEH
008F AA02                              OR     A,#002H
0091 C75420                            LD     05420H,A
0094         ?WHILE_0009:
              ; SOURCE LINE # 1036 
0094 A603                              LD     A,#003H
0096 C45421                            AND    A,05421H
0099 A102                              CP     A,#002H
009B 2709                              JREQ   ?NXT_0156
009D 1E01       F                      LDW    X,(001H,SP)   ; [ timeout ]
009F 2705                              JREQ   ?NXT_0156
              ; SOURCE LINE # 1038 
00A1 5A                                DECW   X
00A2 1F01       F                      LDW    (001H,SP),X   ; [ timeout ]
00A4 20EE                              JRA    ?WHILE_0009
00A6         ?NXT_0156:
              ; SOURCE LINE # 1040 
00A6 A603                              LD     A,#003H
00A8 C45421                            AND    A,05421H
00AB A102                              CP     A,#002H
00AD 2704                              JREQ   ?ELSE_0139
              ; SOURCE LINE # 1042 
00AF 0F03       F                      CLR    (003H,SP)   ; [ modestatus ]
00B1 2008                              JRA    ?NXT_0148
00B3         ?ELSE_0139:
              ; SOURCE LINE # 1046 
00B3 A601                              LD     A,#001H
00B5 6B03       F                      LD     (003H,SP),A   ; [ modestatus ]
00B7 2002                              JRA    ?NXT_0148
00B9         ?ELSE_0138:
              ; SOURCE LINE # 1051 
00B9 0F03       F                      CLR    (003H,SP)   ; [ modestatus ]
00BB         ?NXT_0148:
              ; SOURCE LINE # 1053 
00BB 7B03       F                      LD     A,(003H,SP)   ; [ modestatus ]
00BD 5F                                CLRW   X
00BE 97                                LD     XL,A
              ; SOURCE LINE # 1054 
00BF 5B05                              ADD    SP,#005H
00C1 81                                RET    
              ; CAN_OperatingMode (size=2).  parameter in AUTO
              ; timeout      unsigned short  (size=2-Alg). Automatic variable  in AUTO
              ; modestatus   unsigned char  (size=1). Automatic variable  in AUTO

              ; FUNCTION ?CAN_OperatingModeRequest (END)

              ; FUNCTION ?CAN_GetLastErrorCode (BEGIN)
              ; SOURCE LINE # 1061 
0000 5204                              SUB    SP,#004H
              ; SOURCE LINE # 1064 
0002 CD0000     F                      CALL   ?CAN_GetSelectedPage
0005 1F03       F                      LDW    (003H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 1066 
0007 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1067 
000B C65428                            LD     A,05428H
000E A470                              AND    A,#070H
0010 5F                                CLRW   X
0011 97                                LD     XL,A
0012 1F01       F                      LDW    (001H,SP),X   ; [ errcode ]
              ; SOURCE LINE # 1070 
0014 1E03       F                      LDW    X,(003H,SP)   ; [ can_page ]
0016 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 1072 
0019 1E01       F                      LDW    X,(001H,SP)   ; [ errcode ]
              ; SOURCE LINE # 1073 
001B 5B04                              ADD    SP,#004H
001D 81                                RET    
              ; errcode      (size=2). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_GetLastErrorCode (END)

              ; FUNCTION ?CAN_ClearFlag (BEGIN)
              ; Register-parameter CAN_Flag (XW) is relocated (auto)
              ; SOURCE LINE # 1087 
0000 89                                PUSHW  X
              ; SOURCE LINE # 1089 
0001 5F                                CLRW   X
0002 89                                PUSHW  X
              ; SOURCE LINE # 1091 
0003 AE3401                            LDW    X,#03401H
0006 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
0008 2736                              JREQ   ?NXT_0165
000A 5C                                INCW   X
000B 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
000D 2731                              JREQ   ?NXT_0165
000F AE3404                            LDW    X,#03404H
0012 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
0014 272A                              JREQ   ?NXT_0165
0016 AE3208                            LDW    X,#03208H
0019 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
001B 2723                              JREQ   ?NXT_0165
001D AE3210                            LDW    X,#03210H
0020 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
0022 271C                              JREQ   ?NXT_0165
0024 AE3108                            LDW    X,#03108H
0027 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
0029 2715                              JREQ   ?NXT_0165
002B AE3070                            LDW    X,#03070H
002E 1303       F                      CPW    X,(003H,SP)   ; [ CAN_Flag ]
0030 270E                              JREQ   ?NXT_0165
0032 AE0443                            LDW    X,#00443H
0035 89                                PUSHW  X
0036 5F                                CLRW   X
0037 89                                PUSHW  X
0038 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
003B CD0000     F                      CALL   ?assert_failed
003E 5B04                              ADD    SP,#004H
0040         ?NXT_0165:
              ; SOURCE LINE # 1092 
0040 7B03       F                      LD     A,(003H,SP)   ; [ CAN_Flag ]
0042 A407                              AND    A,#007H
0044 B703       F                      LD     ?BH,A
0046 3F04       F                      CLR    ?BL
0048 BE02       F                      LDW    X,?BH.w
004A 2735                              JREQ   ?ELSE_0145
              ; SOURCE LINE # 1094 
004C 7B04       F                      LD     A,(004H,SP)   ; [ CAN_Flag + 01H ]
004E A40B                              AND    A,#00BH
0050 B704       F                      LD     ?BL,A
0052 7B03       F                      LD     A,(003H,SP)   ; [ CAN_Flag ]
0054 A402                              AND    A,#002H
0056 B703       F                      LD     ?BH,A
0058 BE02       F                      LDW    X,?BH.w
005A 2707                              JREQ   ?ELSE_0146
              ; SOURCE LINE # 1097 
005C 7B04       F                      LD     A,(004H,SP)   ; [ CAN_Flag + 01H ]
005E C75424                            LD     05424H,A
0061 202C                              JRA    ?EPILOG_0023
0063         ?ELSE_0146:
              ; SOURCE LINE # 1099 
0063 7B04       F                      LD     A,(004H,SP)   ; [ CAN_Flag + 01H ]
0065 A403                              AND    A,#003H
0067 B704       F                      LD     ?BL,A
0069 7B03       F                      LD     A,(003H,SP)   ; [ CAN_Flag ]
006B A404                              AND    A,#004H
006D B703       F                      LD     ?BH,A
006F BE02       F                      LDW    X,?BH.w
0071 2707                              JREQ   ?ELSE_0147
              ; SOURCE LINE # 1102 
0073 7B04       F                      LD     A,(004H,SP)   ; [ CAN_Flag + 01H ]
0075 C75422                            LD     05422H,A
0078 2015                              JRA    ?EPILOG_0023
007A         ?ELSE_0147:
              ; SOURCE LINE # 1107 
007A 7B04       F                      LD     A,(004H,SP)   ; [ CAN_Flag + 01H ]
007C C75421                            LD     05421H,A
007F 200E                              JRA    ?EPILOG_0023
0081         ?ELSE_0145:
              ; SOURCE LINE # 1113 
0081 CD0000     F                      CALL   ?CAN_GetSelectedPage
              ; SOURCE LINE # 1116 
0084 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1117 
0088 725F5428                          CLR    05428H
              ; SOURCE LINE # 1120 
008C CD0000     F                      CALL   ?CAN_SelectPage
008F         ?EPILOG_0023:
              ; SOURCE LINE # 1122 
008F 5B04                              ADD    SP,#004H
0091 81                                RET    
              ; CAN_Flag     (size=2).  parameter in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_ClearFlag (END)

              ; FUNCTION ?CAN_GetFlagStatus (BEGIN)
              ; Register-parameter CAN_Flag (XW) is relocated (auto)
              ; SOURCE LINE # 1129 
0000 89                                PUSHW  X
0001 5204                              SUB    SP,#004H
              ; SOURCE LINE # 1135 
0003 AE3401                            LDW    X,#03401H
0006 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0008 2750                              JREQ   ?NXT_0187
000A 5C                                INCW   X
000B 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
000D 274B                              JREQ   ?NXT_0187
000F AE3404                            LDW    X,#03404H
0012 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0014 2744                              JREQ   ?NXT_0187
0016 AE1203                            LDW    X,#01203H
0019 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
001B 273D                              JREQ   ?NXT_0187
001D AE3208                            LDW    X,#03208H
0020 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0022 2736                              JREQ   ?NXT_0187
0024 AE3210                            LDW    X,#03210H
0027 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0029 272F                              JREQ   ?NXT_0187
002B AE3108                            LDW    X,#03108H
002E 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0030 2728                              JREQ   ?NXT_0187
0032 AE1001                            LDW    X,#01001H
0035 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0037 2721                              JREQ   ?NXT_0187
0039 5C                                INCW   X
003A 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
003C 271C                              JREQ   ?NXT_0187
003E AE1004                            LDW    X,#01004H
0041 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
0043 2715                              JREQ   ?NXT_0187
0045 AE3070                            LDW    X,#03070H
0048 1305       F                      CPW    X,(005H,SP)   ; [ CAN_Flag ]
004A 270E                              JREQ   ?NXT_0187
004C AE046F                            LDW    X,#0046FH
004F 89                                PUSHW  X
0050 5F                                CLRW   X
0051 89                                PUSHW  X
0052 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0055 CD0000     F                      CALL   ?assert_failed
0058 5B04                              ADD    SP,#004H
005A         ?NXT_0187:
              ; SOURCE LINE # 1137 
005A 7B05       F                      LD     A,(005H,SP)   ; [ CAN_Flag ]
005C A407                              AND    A,#007H
005E B703       F                      LD     ?BH,A
0060 3F04       F                      CLR    ?BL
0062 BE02       F                      LDW    X,?BH.w
0064 2753                              JREQ   ?ELSE_0157
              ; SOURCE LINE # 1139 
0066 7B06       F                      LD     A,(006H,SP)   ; [ CAN_Flag + 01H ]
0068 A40B                              AND    A,#00BH
006A B704       F                      LD     ?BL,A
006C 7B05       F                      LD     A,(005H,SP)   ; [ CAN_Flag ]
006E A402                              AND    A,#002H
0070 B703       F                      LD     ?BH,A
0072 BE02       F                      LDW    X,?BH.w
0074 2711                              JREQ   ?ELSE_0158
              ; SOURCE LINE # 1142 
0076 7B06       F                      LD     A,(006H,SP)   ; [ CAN_Flag + 01H ]
0078 5F                                CLRW   X
0079 C55424                            BCP    A,05424H
007C 2705                              JREQ   ?ELSE_0159
              ; SOURCE LINE # 1145 
007E 5C                                INCW   X
007F 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
0081 204F                              JRA    ?NXT_0188
0083         ?ELSE_0159:
              ; SOURCE LINE # 1150 
0083 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
0085 204B                              JRA    ?NXT_0188
0087         ?ELSE_0158:
              ; SOURCE LINE # 1154 
0087 7B06       F                      LD     A,(006H,SP)   ; [ CAN_Flag + 01H ]
0089 A403                              AND    A,#003H
008B B704       F                      LD     ?BL,A
008D 7B05       F                      LD     A,(005H,SP)   ; [ CAN_Flag ]
008F A404                              AND    A,#004H
0091 B703       F                      LD     ?BH,A
0093 BE02       F                      LDW    X,?BH.w
0095 2711                              JREQ   ?ELSE_0160
              ; SOURCE LINE # 1157 
0097 7B06       F                      LD     A,(006H,SP)   ; [ CAN_Flag + 01H ]
0099 5F                                CLRW   X
009A C55422                            BCP    A,05422H
009D 2705                              JREQ   ?ELSE_0161
              ; SOURCE LINE # 1160 
009F 5C                                INCW   X
00A0 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
00A2 202E                              JRA    ?NXT_0188
00A4         ?ELSE_0161:
              ; SOURCE LINE # 1165 
00A4 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
00A6 202A                              JRA    ?NXT_0188
00A8         ?ELSE_0160:
              ; SOURCE LINE # 1171 
00A8 7B06       F                      LD     A,(006H,SP)   ; [ CAN_Flag + 01H ]
00AA 5F                                CLRW   X
00AB C55421                            BCP    A,05421H
00AE 2705                              JREQ   ?ELSE_0162
              ; SOURCE LINE # 1174 
00B0 5C                                INCW   X
00B1 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
00B3 201D                              JRA    ?NXT_0188
00B5         ?ELSE_0162:
              ; SOURCE LINE # 1179 
00B5 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
00B7 2019                              JRA    ?NXT_0188
00B9         ?ELSE_0157:
              ; SOURCE LINE # 1186 
00B9 CD0000     F                      CALL   ?CAN_GetSelectedPage
00BC 1F03       F                      LDW    (003H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 1188 
00BE 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1189 
00C2 7B06       F                      LD     A,(006H,SP)   ; [ CAN_Flag + 01H ]
00C4 5F                                CLRW   X
00C5 C55428                            BCP    A,05428H
00C8 2701                              JREQ   ?ELSE_0163
              ; SOURCE LINE # 1192 
00CA 5C                                INCW   X
00CB         ?ELSE_0163:
              ; SOURCE LINE # 1197 
00CB 1F01       F                      LDW    (001H,SP),X   ; [ bitstatus ]
              ; SOURCE LINE # 1200 
00CD 1E03       F                      LDW    X,(003H,SP)   ; [ can_page ]
00CF CD0000     F                      CALL   ?CAN_SelectPage
00D2         ?NXT_0188:
              ; SOURCE LINE # 1205 
00D2 1E01       F                      LDW    X,(001H,SP)   ; [ bitstatus ]
              ; SOURCE LINE # 1206 
00D4 5B06                              ADD    SP,#006H
00D6 81                                RET    
              ; CAN_Flag     (size=2).  parameter in AUTO
              ; bitstatus    (size=2). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_GetFlagStatus (END)

              ; FUNCTION ?CAN_GetITStatus (BEGIN)
              ; Register-parameter CAN_IT (XW) is relocated (auto)
              ; SOURCE LINE # 1213 
0000 89                                PUSHW  X
0001 5204                              SUB    SP,#004H
              ; SOURCE LINE # 1215 
0003 5F                                CLRW   X
0004 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
              ; SOURCE LINE # 1216 
0006 CD0000     F                      CALL   ?CAN_GetSelectedPage
0009 1F03       F                      LDW    (003H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 1219 
000B 5F                                CLRW   X
000C 5C                                INCW   X
000D 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
000F 274B                              JREQ   ?NXT_0214
0011 5C                                INCW   X
0012 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
0014 2746                              JREQ   ?NXT_0214
0016 AE0004                            LDW    X,#00004H
0019 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
001B 273F                              JREQ   ?NXT_0214
001D AE0008                            LDW    X,#00008H
0020 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
0022 2738                              JREQ   ?NXT_0214
0024 AE0080                            LDW    X,#00080H
0027 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
0029 2731                              JREQ   ?NXT_0214
002B AE4000                            LDW    X,#04000H
002E 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
0030 272A                              JREQ   ?NXT_0214
0032 AE0100                            LDW    X,#00100H
0035 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
0037 2723                              JREQ   ?NXT_0214
0039 AE0200                            LDW    X,#00200H
003C 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
003E 271C                              JREQ   ?NXT_0214
0040 AE0400                            LDW    X,#00400H
0043 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
0045 2715                              JREQ   ?NXT_0214
0047 AE0800                            LDW    X,#00800H
004A 1305       F                      CPW    X,(005H,SP)   ; [ CAN_IT ]
004C 270E                              JREQ   ?NXT_0214
004E AE04C3                            LDW    X,#004C3H
0051 89                                PUSHW  X
0052 5F                                CLRW   X
0053 89                                PUSHW  X
0054 AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
0057 CD0000     F                      CALL   ?assert_failed
005A 5B04                              ADD    SP,#004H
005C         ?NXT_0214:
              ; SOURCE LINE # 1222 
005C 1E05       F                      LDW    X,(005H,SP)   ; [ CAN_IT ]
005E A30001                            CPW    X,#00001H
0061 274A                              JREQ   ?CASE_0024
0063 A30002                            CPW    X,#00002H
0066 275E                              JREQ   ?CASE_0025
0068 A30004                            CPW    X,#00004H
006B 276E                              JREQ   ?CASE_0026
006D A30008                            CPW    X,#00008H
0070 277E                              JREQ   ?CASE_0027
0072 A30080                            CPW    X,#00080H
0075 2603                              JRNE   ?LAB_0178
0077 CC0000     F                      JP     ?CASE_0028
007A         ?LAB_0178:
007A A30100                            CPW    X,#00100H
007D 2603                              JRNE   ?LAB_0173
007F CC0000     F                      JP     ?CASE_0029
0082         ?LAB_0173:
0082 A30200                            CPW    X,#00200H
0085 2603                              JRNE   ?LAB_0174
0087 CC0000     F                      JP     ?CASE_0030
008A         ?LAB_0174:
008A A30400                            CPW    X,#00400H
008D 2603                              JRNE   ?LAB_0175
008F CC0000     F                      JP     ?CASE_0031
0092         ?LAB_0175:
0092 A30800                            CPW    X,#00800H
0095 2603                              JRNE   ?LAB_0176
0097 CC0000     F                      JP     ?CASE_0032
009A         ?LAB_0176:
009A A34000                            CPW    X,#04000H
009D 2703                              JREQ   ?LAB_0177
009F CC0000     F                      JP     ?DEFAULT_0005
00A2         ?LAB_0177:
00A2 35065427                          MOV    05427H,#006H
00A6 720F54297B                        BTJF   05429H,#007H,?ELSE_0181
00AB 206C                              JRA    ?CASE_0033
00AD         ?CASE_0024:
              ; SOURCE LINE # 1225 
00AD 720154250E                        BTJF   05425H,#000H,?ELSE_0176
              ; SOURCE LINE # 1227 
00B2 4B07                              PUSH   #007H
00B4 C65422                            LD     A,05422H
00B7 CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
00BA 84                                POP    A
00BB 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
00BD CC0000     F                      JP     ?NXT_0215
00C0         ?ELSE_0176:

00C0         ?OPTI_0012:
              ; SOURCE LINE # 1231 
00C0 5F                                CLRW   X
00C1 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
              ; SOURCE LINE # 1233 
00C3 CC0000     F                      JP     ?NXT_0215
00C6         ?CASE_0025:
              ; SOURCE LINE # 1236 
00C6 720354250E                        BTJF   05425H,#001H,?ELSE_0177
              ; SOURCE LINE # 1238 
00CB 4B03                              PUSH   #003H
00CD C65424                            LD     A,05424H
00D0 CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
00D3 84                                POP    A
00D4 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
00D6 CC0000     F                      JP     ?NXT_0215
00D9         ?ELSE_0177:
              ; SOURCE LINE # 1244 
00D9 20E5                              JRA    ?OPTI_0012
00DB         ?CASE_0026:
              ; SOURCE LINE # 1246 
00DB 720554250E                        BTJF   05425H,#002H,?ELSE_0178
              ; SOURCE LINE # 1248 
00E0 4B08                              PUSH   #008H
00E2 C65424                            LD     A,05424H
00E5 CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
00E8 84                                POP    A
00E9 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
00EB CC0000     F                      JP     ?NXT_0215
00EE         ?ELSE_0178:
              ; SOURCE LINE # 1254 
00EE 20D0                              JRA    ?OPTI_0012
00F0         ?CASE_0027:
              ; SOURCE LINE # 1256 
00F0 720754250E                        BTJF   05425H,#003H,?ELSE_0179
              ; SOURCE LINE # 1258 
00F5 4B10                              PUSH   #010H
00F7 C65424                            LD     A,05424H
00FA CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
00FD 84                                POP    A
00FE 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
0100 CC0000     F                      JP     ?NXT_0215
0103         ?ELSE_0179:
              ; SOURCE LINE # 1264 
0103 20BB                              JRA    ?OPTI_0012
0105         ?CASE_0028:
              ; SOURCE LINE # 1266 
0105 720F54250D                        BTJF   05425H,#007H,?ELSE_0180
              ; SOURCE LINE # 1268 
010A 4B08                              PUSH   #008H
010C C65421                            LD     A,05421H
010F CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
0112 84                                POP    A
0113 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
0115 2077                              JRA    ?NXT_0215
0117         ?ELSE_0180:
              ; SOURCE LINE # 1274 
0117 20A7                              JRA    ?OPTI_0012
0119         ?CASE_0033:
              ; SOURCE LINE # 1280 
0119 4B77                              PUSH   #077H
011B C65428                            LD     A,05428H
011E CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
0121 84                                POP    A
0122 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
0124 2068                              JRA    ?NXT_0215
0126         ?ELSE_0181:
              ; SOURCE LINE # 1286 
0126 2098                              JRA    ?OPTI_0012
0128         ?CASE_0029:
              ; SOURCE LINE # 1289 
0128 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1290 
012C 720154290D                        BTJF   05429H,#000H,?ELSE_0182
              ; SOURCE LINE # 1292 
0131 4B01                              PUSH   #001H
0133 C65428                            LD     A,05428H
0136 CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
0139 84                                POP    A
013A 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
013C 2050                              JRA    ?NXT_0215
013E         ?ELSE_0182:
              ; SOURCE LINE # 1298 
013E 2080                              JRA    ?OPTI_0012
0140         ?CASE_0030:
              ; SOURCE LINE # 1301 
0140 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1302 
0144 720354290D                        BTJF   05429H,#001H,?ELSE_0183
              ; SOURCE LINE # 1304 
0149 4B02                              PUSH   #002H
014B C65428                            LD     A,05428H
014E CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
0151 84                                POP    A
0152 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
0154 2038                              JRA    ?NXT_0215
0156         ?ELSE_0183:
              ; SOURCE LINE # 1310 
0156 CC0000     F                      JP     ?OPTI_0012
0159         ?CASE_0031:
              ; SOURCE LINE # 1312 
0159 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1313 
015D 720554290D                        BTJF   05429H,#002H,?ELSE_0184
              ; SOURCE LINE # 1315 
0162 4B04                              PUSH   #004H
0164 C65428                            LD     A,05428H
0167 CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
016A 84                                POP    A
016B 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
016D 201F                              JRA    ?NXT_0215
016F         ?ELSE_0184:
              ; SOURCE LINE # 1321 
016F CC0000     F                      JP     ?OPTI_0012
0172         ?CASE_0032:
              ; SOURCE LINE # 1323 
0172 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1324 
0176 720954290D                        BTJF   05429H,#004H,?ELSE_0185
              ; SOURCE LINE # 1326 
017B 4B70                              PUSH   #070H
017D C65428                            LD     A,05428H
0180 CD0000     F                      CALL   ?CheckITStatus?STM8S_CAN?S
0183 84                                POP    A
0184 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
0186 2006                              JRA    ?NXT_0215
0188         ?ELSE_0185:
              ; SOURCE LINE # 1332 
0188 CC0000     F                      JP     ?OPTI_0012
018B         ?DEFAULT_0005:
              ; SOURCE LINE # 1334 
018B 5F                                CLRW   X
018C 1F01       F                      LDW    (001H,SP),X   ; [ pendingbitstatus ]
018E         ?NXT_0215:
              ; SOURCE LINE # 1338 
018E 1E03       F                      LDW    X,(003H,SP)   ; [ can_page ]
0190 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 1340 
0193 1E01       F                      LDW    X,(001H,SP)   ; [ pendingbitstatus ]
              ; SOURCE LINE # 1341 
0195 5B06                              ADD    SP,#006H
0197 81                                RET    
              ; CAN_IT       (size=2).  parameter in AUTO
              ; pendingbitstatus (size=2). Automatic variable  in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_GetITStatus (END)

              ; FUNCTION ?CAN_ClearITPendingBit (BEGIN)
              ; Register-parameter CAN_IT (XW) is relocated (auto)
              ; SOURCE LINE # 1358 
0000 89                                PUSHW  X
0001 89                                PUSHW  X
              ; SOURCE LINE # 1360 
0002 CD0000     F                      CALL   ?CAN_GetSelectedPage
0005 1F01       F                      LDW    (001H,SP),X   ; [ can_page ]
              ; SOURCE LINE # 1362 
0007 5F                                CLRW   X
0008 5C                                INCW   X
0009 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
000B 2746                              JREQ   ?NXT_0228
000D AE0004                            LDW    X,#00004H
0010 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
0012 273F                              JREQ   ?NXT_0228
0014 AE0008                            LDW    X,#00008H
0017 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
0019 2738                              JREQ   ?NXT_0228
001B AE0080                            LDW    X,#00080H
001E 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
0020 2731                              JREQ   ?NXT_0228
0022 AE4000                            LDW    X,#04000H
0025 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
0027 272A                              JREQ   ?NXT_0228
0029 AE0100                            LDW    X,#00100H
002C 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
002E 2723                              JREQ   ?NXT_0228
0030 AE0200                            LDW    X,#00200H
0033 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
0035 271C                              JREQ   ?NXT_0228
0037 AE0400                            LDW    X,#00400H
003A 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
003C 2715                              JREQ   ?NXT_0228
003E AE0800                            LDW    X,#00800H
0041 1303       F                      CPW    X,(003H,SP)   ; [ CAN_IT ]
0043 270E                              JREQ   ?NXT_0228
0045 AE0552                            LDW    X,#00552H
0048 89                                PUSHW  X
0049 5F                                CLRW   X
004A 89                                PUSHW  X
004B AE0000     F                      LDW    X,#HIGH(?STR?STM8S_CAN?BASE)
004E CD0000     F                      CALL   ?assert_failed
0051 5B04                              ADD    SP,#004H
0053         ?NXT_0228:
              ; SOURCE LINE # 1364 
0053 1E03       F                      LDW    X,(003H,SP)   ; [ CAN_IT ]
0055 A30001                            CPW    X,#00001H
0058 2732                              JREQ   ?CASE_0043
005A A30004                            CPW    X,#00004H
005D 2733                              JREQ   ?CASE_0044
005F A30008                            CPW    X,#00008H
0062 2734                              JREQ   ?CASE_0045
0064 A30080                            CPW    X,#00080H
0067 2735                              JREQ   ?CASE_0046
0069 A30100                            CPW    X,#00100H
006C 2736                              JREQ   ?OPTI_0015
006E A30200                            CPW    X,#00200H
0071 2731                              JREQ   ?OPTI_0015
0073 A30400                            CPW    X,#00400H
0076 272C                              JREQ   ?OPTI_0015
0078 A30800                            CPW    X,#00800H
007B 272D                              JREQ   ?CASE_0050
007D A34000                            CPW    X,#04000H
0080 2630                              JRNE   ?NXT_0229
0082 35065427                          MOV    05427H,#006H
0086 725F5428                          CLR    05428H
008A 2018                              JRA    ?CASE_0051
008C         ?CASE_0043:
              ; SOURCE LINE # 1367 
008C 35075422                          MOV    05422H,#007H
              ; SOURCE LINE # 1368 
0090 2020                              JRA    ?NXT_0229
0092         ?CASE_0044:
              ; SOURCE LINE # 1371 
0092 35085424                          MOV    05424H,#008H
              ; SOURCE LINE # 1372 
0096 201A                              JRA    ?NXT_0229
0098         ?CASE_0045:
              ; SOURCE LINE # 1375 
0098 35105424                          MOV    05424H,#010H
              ; SOURCE LINE # 1376 
009C 2014                              JRA    ?NXT_0229
009E         ?CASE_0046:
              ; SOURCE LINE # 1379 
009E 35085421                          MOV    05421H,#008H
              ; SOURCE LINE # 1380 
00A2 200E                              JRA    ?NXT_0229
00A4         ?CASE_0051:

00A4         ?OPTI_0015:
              ; SOURCE LINE # 1385 
00A4 35045421                          MOV    05421H,#004H
              ; SOURCE LINE # 1386 
00A8 2008                              JRA    ?NXT_0229
00AA         ?CASE_0050:
              ; SOURCE LINE # 1401 
00AA 35065427                          MOV    05427H,#006H
              ; SOURCE LINE # 1402 
00AE 725F5428                          CLR    05428H
00B2         ?NXT_0229:
              ; SOURCE LINE # 1411 
00B2 1E01       F                      LDW    X,(001H,SP)   ; [ can_page ]
00B4 CD0000     F                      CALL   ?CAN_SelectPage
              ; SOURCE LINE # 1412 
00B7 5B04                              ADD    SP,#004H
00B9 81                                RET    
              ; CAN_IT       (size=2).  parameter in AUTO
              ; can_page     (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CAN_ClearITPendingBit (END)

              ; FUNCTION ?CAN_GetSelectedPage (BEGIN)
              ; SOURCE LINE # 1421 
0000 C65427                            LD     A,05427H
0003 5F                                CLRW   X
0004 97                                LD     XL,A
              ; SOURCE LINE # 1422 
0005 81                                RET    

              ; FUNCTION ?CAN_GetSelectedPage (END)

              ; FUNCTION ?CAN_SelectPage (BEGIN)
              ; Register XW is assigned to parameter CAN_Page
              ; SOURCE LINE # 1431 
0000 9F                                LD     A,XL
0001 C75427                            LD     05427H,A
              ; SOURCE LINE # 1432 
0004 81                                RET    
              ; CAN_Page     (size=2). Register parameter(XW) in PAGE0

              ; FUNCTION ?CAN_SelectPage (END)

              ; FUNCTION ?CheckITStatus?STM8S_CAN?S (BEGIN)
              ; Register-parameter CAN_Reg (A) is relocated (auto)
              ; SOURCE LINE # 1440 
0000 88                                PUSH   A
              ; SOURCE LINE # 1442 
0001 5F                                CLRW   X
0002 89                                PUSHW  X
              ; SOURCE LINE # 1443 
0003 7B06       F                      LD     A,(006H,SP)   ; [ It_Bit ]
0005 1503       F                      BCP    A,(003H,SP)   ; [ CAN_Reg ]
0007 2703                              JREQ   ?ELSE_0189
              ; SOURCE LINE # 1446 
0009 5C                                INCW   X
000A 2001                              JRA    ?NXT_0232
000C         ?ELSE_0189:
              ; SOURCE LINE # 1451 
000C 5F                                CLRW   X
000D         ?NXT_0232:
              ; SOURCE LINE # 1454 
000D 5B03                              ADD    SP,#003H
000F 81                                RET    
              ; CAN_Reg      unsigned char  (size=1).  parameter in AUTO
              ; It_Bit       unsigned char  (size=1).  parameter in AUTO
              ; pendingbitstatus (size=2). Automatic variable  in AUTO

              ; FUNCTION ?CheckITStatus?STM8S_CAN?S (END)

RCSTM8 COMPILER V2.42.12.083


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4004    ----
   CONSTANT SIZE    =     70    ----
   DATA SIZE        =   ----    ----
   PAGE0 SIZE       =     27    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

RCSTM8 COMPILATION COMPLETE.  0 WARNING,  0 ERROR
